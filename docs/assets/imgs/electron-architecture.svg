<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 900">
  <defs>
    <style>
      .box { fill: #ffffff; stroke: #333; stroke-width: 2; }
      .header { fill: #4a90e2; stroke: #333; stroke-width: 2; }
      .renderer { fill: #e8f4f8; }
      .main { fill: #fff4e6; }
      .docker { fill: #e6f3ff; }
      .container { fill: #f0f0f0; }
      .text { font-family: Arial, sans-serif; font-size: 14px; fill: #333; }
      .text-bold { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #fff; }
      .text-small { font-family: Arial, sans-serif; font-size: 12px; fill: #555; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-bi { stroke: #4a90e2; stroke-width: 2; fill: none; marker-end: url(#arrowhead-bi); marker-start: url(#arrowhead-bi-start); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowhead-bi" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#4a90e2" />
    </marker>
    <marker id="arrowhead-bi-start" markerWidth="10" markerHeight="10" refX="1" refY="3" orient="auto">
      <polygon points="10 0, 0 3, 10 6" fill="#4a90e2" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="30" class="text-bold" text-anchor="middle" style="fill: #333; font-size: 20px;">TI-Toolbox Desktop App Architecture</text>

  <!-- Electron App Container -->
  <rect class="header" x="50" y="60" width="700" height="50" rx="5"/>
  <text x="400" y="90" class="text-bold" text-anchor="middle">Electron Application</text>

  <!-- Renderer Process -->
  <rect class="box renderer" x="80" y="140" width="280" height="200" rx="5"/>
  <rect class="header" x="80" y="140" width="280" height="35" rx="5"/>
  <text x="220" y="162" class="text-bold" text-anchor="middle">Renderer Process</text>
  <text x="90" y="190" class="text-small">(UI Layer)</text>
  
  <text x="90" y="215" class="text-small">• index.html</text>
  <text x="90" y="235" class="text-small">• styles.css</text>
  <text x="90" y="255" class="text-small">• renderer.js</text>
  <text x="90" y="280" class="text-small">Features:</text>
  <text x="90" y="300" class="text-small">  - Project selection</text>
  <text x="90" y="320" class="text-small">  - Status display</text>

  <!-- Main Process -->
  <rect class="box main" x="440" y="140" width="280" height="200" rx="5"/>
  <rect class="header" x="440" y="140" width="280" height="35" rx="5"/>
  <text x="580" y="162" class="text-bold" text-anchor="middle">Main Process</text>
  <text x="450" y="190" class="text-small">(Backend Logic)</text>
  
  <text x="450" y="215" class="text-small">• main.js</text>
  <text x="450" y="235" class="text-small">• docker-manager.js</text>
  <text x="450" y="255" class="text-small">• env.js</text>
  <text x="450" y="275" class="text-small">• project-service.js</text>
  <text x="450" y="295" class="text-small">• config-store.js</text>
  <text x="450" y="315" class="text-small">• logger.js</text>

  <!-- IPC Communication -->
  <path class="arrow-bi" d="M 360 240 L 440 240"/>
  <text x="400" y="230" class="text-small" text-anchor="middle" style="fill: #4a90e2; font-weight: bold;">IPC</text>

  <!-- Docker Desktop -->
  <rect class="box docker" x="150" y="400" width="500" height="80" rx="5"/>
  <rect class="header" x="150" y="400" width="500" height="35" rx="5"/>
  <text x="400" y="422" class="text-bold" text-anchor="middle">Docker Desktop</text>
  <text x="160" y="450" class="text-small">Container Runtime</text>
  <text x="160" y="470" class="text-small">• dockerode API for health checks &amp; GUI exec</text>

  <!-- Arrow from Main to Docker -->
  <path class="arrow" d="M 580 340 L 580 400"/>
  <text x="590" y="370" class="text-small">Docker</text>
  <text x="590" y="385" class="text-small">Client</text>

  <!-- Docker Compose Services -->
  <rect class="box container" x="150" y="520" width="500" height="100" rx="5"/>
  <rect class="header" x="150" y="520" width="500" height="35" rx="5"/>
  <text x="400" y="542" class="text-bold" text-anchor="middle">Docker Compose Services</text>
  <text x="160" y="570" class="text-small">• freesurfer_container</text>
  <text x="160" y="590" class="text-small">• simnibs_container</text>
  <text x="160" y="610" class="text-small">(docker-compose.yml)</text>

  <!-- Arrow from Docker to Compose -->
  <path class="arrow" d="M 400 480 L 400 520"/>

  <!-- SimNIBS Container -->
  <rect class="box" x="150" y="660" width="220" height="100" rx="5"/>
  <rect class="header" x="150" y="660" width="220" height="35" rx="5"/>
  <text x="260" y="682" class="text-bold" text-anchor="middle">SimNIBS Container</text>
  <text x="160" y="710" class="text-small">• TI-Toolbox GUI (PyQt5)</text>
  <text x="160" y="730" class="text-small">• X11 Forwarding</text>
  <text x="160" y="750" class="text-small">• Python environment</text>

  <!-- Project Directory -->
  <rect class="box" x="430" y="660" width="220" height="100" rx="5"/>
  <rect class="header" x="430" y="660" width="220" height="35" rx="5"/>
  <text x="540" y="682" class="text-bold" text-anchor="middle">Project Directory</text>
  <text x="440" y="710" class="text-small">BIDS-compliant structure:</text>
  <text x="440" y="730" class="text-small">• sourcedata/</text>
  <text x="440" y="750" class="text-small">• derivatives/</text>

  <!-- Arrows from Compose to containers -->
  <path class="arrow" d="M 280 620 L 260 660"/>
  <path class="arrow" d="M 520 620 L 540 660"/>

  <!-- Platform Notes -->
  <rect class="box" x="80" y="800" width="640" height="80" rx="5" style="fill: #fffbf0;"/>
  <text x="90" y="820" class="text" style="font-weight: bold;">Platform-specific X11 Display:</text>
  <text x="90" y="840" class="text-small">• macOS: XQuartz (host.docker.internal:0)</text>
  <text x="90" y="858" class="text-small">• Linux: Native X11 (:0)</text>
  <text x="90" y="876" class="text-small">• Windows: VcXsrv/Xming (host.docker.internal:0)</text>
</svg>

