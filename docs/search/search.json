[
  {
    "title": "UI Gallery",
    "content": "TI-Toolbox User Interface Pre-Processing interface for DICOM to NIfTI conversion and FreeSurfer segmentation. Flex-Search interface for evolutionary electrode optimization. Ex-Search interface for exhaustive electrode combination search. Simulations interface for temporal interference field analysis. Analysis interface for comprehensive results visualization. NIfTI file processing and visualization interface. System monitoring interface for tracking toolbox processes. CBPT (Computational Brain Phantom Toolkit) interface for phantom-based simulations. Extension manager interface for toolbox customization and plugin management. NIfTI group averaging interface for multi-subject data analysis. NiLearn visualization interface for advanced brain imaging plots and graphics. &times; &#10094; &#10095; .gallery-section { margin: 2rem 0; padding: 1rem; background-color: #f8f9fa; } .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; margin-top: 1rem; } .gallery-item { background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; transition: transform 0.2s ease, box-shadow 0.2s ease; } .gallery-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); } /* Override wiki.css image styles with more specific selectors and !important */ .wiki-content .gallery-item img, .gallery-item img { width: 100% !important; max-width: 500px !important; max-height: 400px !important; height: auto !important; object-fit: contain !important; border-radius: 4px !important; margin-bottom: 0.5rem !important; margin-left: auto !important; margin-right: auto !important; margin-top: 0 !important; display: block !important; box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important; loading: lazy; } .gallery-item p { margin: 0; font-size: 0.9rem; color: #666; line-height: 1.4; } @media (max-width: 768px) { .gallery-grid { grid-template-columns: 1fr; gap: 1rem; } .gallery-section { margin: 1rem 0; padding: 0.5rem; } .wiki-content .gallery-item img, .gallery-item img { max-width: 100% !important; max-height: 300px !important; } } @media (max-width: 480px) { .wiki-content .gallery-item img, .gallery-item img { max-height: 250px !important; } }",
    "url": "/gallery/UI/"
  },
  {
    "title": "About",
    "content": "The Temporal Interference Toolbox started as a side project in early 2024 and matured to be a toolbox that allows both inexperience and experience users simulate TI fields from standardized and personalized imaging data. ### Contributors Ido Haber Lead Developer & Project Founder PhD Research Assistant and software developer specializing in computational neurostimulation. Developed the idea and architecture for the TI-Toolbox.  Email  GitHub Aksel Jackson Core Contributor Undergraduate Research Assistant and software developer focused on computational modeling, visualization, and analysis of electric field distribution.  Email  GitHub ## Acknowledgments We extend our gratitude to the developers and contributors of the tools integrated into the TI-Toolbox. - [**Docker**](https://www.docker.com): A containerization platform for developing, shipping, and running distributed applications. - [**Electron**](https://electronjs.org): A framework for building cross-platform desktop applications using web technologies. - [**SimNIBS**:](https://simnibs.github.io/simnibs/build/html/index.html) A simulation environment for transcranial brain stimulation, enabling electric field modeling. - [**FreeSurfer**:](https://surfer.nmr.mgh.harvard.edu/) A software suite for the analysis and visualization of structural and functional neuroimaging data. - [**Gmsh**:](http://gmsh.info/) A three-dimensional finite element mesh generator with a built-in CAD engine and post-processor. - [**FSL**:](https://fsl.fmrib.ox.ac.uk/fsl/) A comprehensive library of tools for analysis of functional and structural brain imaging data. - [**dcm2niix**](https://github.com/rordenlab/dcm2niix): A tool for converting DICOM images to NIfTI format - [**BIDS**](https://bids.neuroimaging.io/): A standardized way to organize and describe neuroimaging data. .contributors-section { margin: 2rem 0; } .contributor-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin-top: 1.5rem; } .contributor-card { background: #f8f9fa; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s ease, box-shadow 0.2s ease; } .contributor-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); } .contributor-avatar { width: 80px; height: 80px; margin: 0 auto 1rem; border-radius: 50%; overflow: hidden; background-color: #e9ecef; } .contributor-avatar img { width: 100%; height: 100%; object-fit: cover; } .contributor-info { text-align: center; } .contributor-info h3 { margin: 0 0 0.25rem; font-size: 1.25rem; } .contributor-role { color: #6c757d; font-weight: 600; margin: 0 0 0.75rem; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; } .contributor-description { color: #495057; line-height: 1.5; margin-bottom: 1rem; font-size: 0.95rem; text-align: Left; } .contributor-links { display: flex; justify-content: center; gap: 0.75rem; flex-wrap: wrap; } .contributor-links a { background: grey; color: white; padding: 0.4rem 0.8rem; border-radius: 20px; text-decoration: none; font-size: 0.85rem; transition: background-color 0.2s ease; } .contributor-links a:hover { background: #0056b3; } @media (max-width: 768px) { .contributor-grid { grid-template-columns: 1fr; gap: 1.5rem; } .contributor-card { padding: 1rem; } .contributor-avatar { width: 60px; height: 60px; } }",
    "url": "/about/"
  },
  {
    "title": "Analysis Gallery",
    "content": "Comprehensive analysis and visualization of TI simulation results, field distributions, and statistical metrics. Field Analysis & Visualization in mesh space (Gmsh Integration) TInorm field distribution showing intensity map in the cortical ROI (Left Insula). Normal component of the TInorm field distribution showing intensity map in the cortical ROI (Left Insula) TInorm field distribution showing intensity map across the entire brain. Field Analysis & Visualization in voxel space (Freesurfer Integration) Montage A: TInorm field distribution showing intensity map in the sub-cortical ROI (Right Hippocampus). Montage B: TInorm field distribution showing intensity map in the sub-cortical ROI (Right Hippocampus). Statistical Analysis & Metrics Histrogram showing focality, intensity cutoffs, and relationship to ROI &times; &#10094; &#10095; .gallery-section { margin: 3rem 0; padding: 1.5rem; background-color: #f8f9fa; border-radius: 8px; } .gallery-section h3 { color: #2c3e50; margin-bottom: 1.5rem; font-size: 1.4rem; font-weight: 600; border-bottom: 2px solid #3498db; padding-bottom: 0.5rem; } .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; margin-top: 1rem; } .gallery-item { background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; transition: transform 0.2s ease, box-shadow 0.2s ease; } .gallery-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); } /* Override wiki.css image styles with more specific selectors and !important */ .wiki-content .gallery-item img, .gallery-item img { width: 100% !important; max-width: 500px !important; max-height: 400px !important; height: auto !important; object-fit: contain !important; border-radius: 4px !important; margin-bottom: 0.5rem !important; margin-left: auto !important; margin-right: auto !important; margin-top: 0 !important; display: block !important; box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important; cursor: pointer !important; loading: lazy; } .gallery-item p { margin: 0; font-size: 0.9rem; color: #666; line-height: 1.4; text-align: left; } @media (max-width: 768px) { .gallery-grid { grid-template-columns: 1fr; gap: 1rem; } .gallery-section { margin: 1rem 0; padding: 1rem; } .wiki-content .gallery-item img, .gallery-item img { max-width: 100% !important; max-height: 300px !important; } } @media (max-width: 480px) { .wiki-content .gallery-item img, .gallery-item img { max-height: 250px !important; } }",
    "url": "/gallery/analysis/"
  },
  {
    "title": "Analyzer Module",
    "content": "The Analyzer module provides analysis capabilities for TI simulation results, supporting both mesh-based and voxel-based data analysis. It provides descriptive statistics and visualization for understanding field distributions in the brain as a whole and specific region of interests. ## Important Quantities of Interest to Recognize - **A. Mean TInorm Intensity in ROI**: Maximal modulation depth (aka TImax). - **B. Mean TInorm Intensity in non-ROI**: Could be defind as entire cortex or a specific avoidance target. - **C. Focality**: Ratio between A/B - **D. TInormal**: Normal compoent of TInorm with respect to fifth layer of the cortex. --- ## Overview The Analyzer module consists of three main components: - **MeshAnalyzer**: Analyzes SimNIBS mesh files (.msh) containing field data - **VoxelAnalyzer**: Analyzes NIfTI files (.nii, .nii.gz, .mgz) containing field data - **Group Analyzer**: Batch processing for multiple subjects and comparative analysis ## Key Features **Spherical ROI Analysis** - Analyze field data within spherical regions of interest - Customizable center coordinates and radius - Dual-field analysis: TI_max and TI_normal components - Statistical metrics: mean, max, min, focality for both field types **Cortical Analysis (Single Region)** - Analyze specific brain regions using atlas parcellation - Support for various atlases (DK40, HCP_MMP1, FreeSurfer) - Detailed regional statistics and visualizations **Whole Head Analysis** - Comprehensive analysis across all brain regions - Batch processing of all atlas regions - Comparative analysis and ranking --- ## Mesh-Based Analysis The MeshAnalyzer works with SimNIBS mesh files and provides high-resolution analysis of field data on brain surfaces. ### Features - **Surface Mesh Generation**: Automatic creation of gray matter surface meshes - **Atlas Integration**: Support for SimNIBS native atlases (DK40, HCP_MMP1) - **Field Extraction**: Analysis of TI_max and TI_normal fields - **3D Visualization**: Generation of mesh files for 3D viewing ### Cortical ROI Analysis TInorm field distribution in ROI (Left Insula) TInormal field distribution in ROI (Left Insula) ### Spherical ROI Analysis Spherical ROI analysis showing TI_max field distribution within a 10mm radius sphere at coordinates (-31.3, 24.0, -37.0) Spherical ROI analysis showing TI_normal field distribution for the same target region, demonstrating directional field components --- ## Voxel-Based Analysis The VoxelAnalyzer handles NIfTI format files and integrates with FreeSurfer atlases for detailed volumetric analysis. ### Features - **NIfTI Support**: Direct analysis of .nii, .nii.gz, .mgz files - **FreeSurfer Integration**: Automatic atlas region extraction - **Visualization Overlays**: Generation of ROI-specific NIfTI overlays Right Hippocampus ROI analysis showing TI_max field distribution given a 1mA:1mA stimualtion --- ### Statistical Analysis Visualization Region-of-interest histogram analysis for left hemisphere insula showing field distribution within target areas ### Field Analysis Metrics **TI_max Field Metrics:** - `mean_value`: Average TI_max field strength in the ROI - `max_value`: Peak TI_max field intensity - `min_value`: Minimum TI_max field intensity - `focality`: ROI average / whole brain average (selectivity measure) **TI_normal Field Metrics:** - `normal_mean_value`: Average TI_normal field strength (directional component) - `normal_max_value`: Peak TI_normal field intensity - `normal_min_value`: Minimum TI_normal field intensity - `normal_focality`: TI_normal ROI average / whole brain average **Additional Information:** - `nodes_in_roi`: Number of mesh nodes within the ROI - `visualization_file`: Path to the generated mesh visualization file --- ## Group Analysis The Group Analyzer enables batch processing and comparative analysis across multiple subjects and montages, supporting flexible experimental designs. ### Flexible Group Combinations The group analyzer now supports **arbitrary combinations** of subjects and montages: - **Same subject  Multiple different montages**: Compare different stimulation configurations within the same individual - **Multiple subjects  Same montage**: Assess inter-subject variability for a specific stimulation protocol - **Multiple subjects  Different montages**: Full factorial design comparing both subject variability and montage effects ### Usage ```bash # Example: Compare the same montage across multiple subjects simnibs_python group_analyzer.py \\ --space mesh \\ --analysis_type spherical \\ --coordinates 10 20 30 \\ --radius 5.0 \\ --subject subj001 /path/to/subj001/m2m montage1 \\ --subject subj002 /path/to/subj002/m2m montage1 \\ --subject subj003 /path/to/subj003/m2m montage1 \\ --output_dir /path/to/group/output # Example: Compare different montages on the same subject simnibs_python group_analyzer.py \\ --space mesh \\ --analysis_type cortical \\ --atlas_name DK40 \\ --region prefrontal \\ --subject subj001 /path/to/subj001/m2m montage1 \\ --subject subj001 /path/to/subj001/m2m montage2 \\ --subject subj001 /path/to/subj001/m2m montage3 \\ --output_dir /path/to/group/output ``` ### Features - **MNI Coordinate Support**: Automatically transform MNI coordinates to each subject's native space using `--use-mni-coords` - **Comprehensive Comparisons**: Automatic generation of statistical comparisons, rankings, and visualizations - **Centralized Logging**: Consolidated logging across all subjects and analyses - **Progress Tracking**: Real-time progress monitoring with timing information --- ## Mesh Analysis Quick Inspection with Gmsh Integration The analyzer now includes **direct Gmsh integration** for easy visualization and inspection of mesh analysis results. ### Features - **One-Click Launch**: Directly launch Gmsh from the GUI to inspect mesh analysis results - **Automatic Mesh Detection**: Automatically finds and loads mesh files (.msh) from completed analyses - **Subject/Simulation Selection**: Dropdown selectors for choosing specific subjects, simulations, and analysis types ### Supported Analysis Types The Gmsh integration works with all mesh-based analyses: - Spherical ROI analyses with generated mesh overlays - Cortical region analyses with atlas-based parcellations - Whole head analyses with comprehensive field distributions",
    "url": "/wiki/analyzer/"
  },
  {
    "title": "Atlas Resampling in Cortical Region Analysis",
    "content": "## Overview When analyzing field data within cortical regions, the toolbox requires that the atlas and field files have matching dimensions and spatial orientation. This document explains how the toolbox handles dimension mismatches and the resampling process. ## Visual Example Below are two images showing the effect of atlas resampling: | Original Atlas (Not Aligned) | Resampled Atlas (Aligned) | |-----------------------------|---------------------------| | ![Original Atlas]({{ site.baseurl }}/assets/imgs/wiki/atlas-resampling/atlas_resample_atlas_under_field.png) | ![Resampled Atlas]({{ site.baseurl }}/assets/imgs/wiki/atlas-resampling/atlas_resample_aligned_atlas_under_field.png) | **Left:** The blue outline shows the original atlas, which does not perfectly align with the heat map of the cortical region (field data). **Right:** The blue outline shows the resampled (aligned) atlas, which now matches the field data. **Explanation:** In the left image, the blue atlas outline does not match the underlying heat map, indicating a dimension or alignment mismatch. In the right image, after resampling, the blue outline of the atlas is perfectly aligned with the heat map, ensuring accurate region analysis. ## Automatic Resampling Process When a dimension mismatch is detected between your atlas and field data, the toolbox automatically: 1. Detects the mismatch by comparing spatial dimensions 2. Creates a resampled version of your atlas using FreeSurfer's `mri_convert` 3. Saves the resampled atlas for future use 4. Proceeds with analysis using the resampled atlas ### Example Log Output ``` [2025-06-05 23:10:26] [analyzer.mesh_analyzer] [INFO] Atlas and field dimensions don't match, attempting to resample... [2025-06-05 23:10:26] [analyzer.mesh_analyzer] [DEBUG] Atlas shape: (256, 256, 256) [2025-06-05 23:10:26] [analyzer.mesh_analyzer] [DEBUG] Field shape: (512, 512, 512) [2025-06-05 23:10:26] [analyzer.mesh_analyzer] [INFO] Running: mri_convert --reslice_like template.nii.gz atlas.mgz resampled_atlas.nii.gz ``` ## Resampled Atlas Storage The resampled atlas is stored with a filename that includes the target dimensions: ``` {original_atlas_name}_resampled_{width}x{height}x{depth}.{extension} ``` For example: ``` subject_dk40_resampled_512x512x512.nii.gz ``` This naming convention allows the toolbox to: - Quickly identify existing resampled versions - Avoid unnecessary re-resampling - Maintain consistency across multiple analyses ## Supported Atlas Formats The toolbox supports various atlas formats: - `.nii` or `.nii.gz` (NIfTI format) - `.mgz` (FreeSurfer format) For `.mgz` files, the toolbox automatically converts them to NIfTI format during the resampling process. ## Common Scenarios ### 1. Different Resolution Field Data If your field data has a different resolution than your atlas: ``` Field data: 512x512x512 voxels Atlas: 256x256x256 voxels ``` The toolbox will automatically resample the atlas to match the field data's resolution. ### 2. Different Field of View If your field data covers a different spatial extent: ``` Field data: 240x240x180 mm Atlas: 256x256x256 mm ``` The resampling process will adjust the atlas to match the field data's spatial coverage. ## Best Practices 1. **Use Subject-Specific Atlases**: Generate atlases using the same preprocessing pipeline as your field data 2. **Check Dimensions**: Verify atlas and field dimensions before analysis 3. **Monitor Logs**: Watch for resampling messages in the log files 4. **Preserve Originals**: Keep your original atlas files; resampled versions are automatically managed ## Technical Details The resampling process uses FreeSurfer's `mri_convert` with the following steps: 1. Creates a template image with target dimensions 2. Uses `--reslice_like` to resample the atlas 3. Preserves the anatomical validity of the atlas 4. Maintains the original atlas's region labels ## Troubleshooting If you encounter issues with resampling: 1. Check the log files for detailed error messages 2. Verify that FreeSurfer is properly installed 3. Ensure both atlas and field files are readable ## See Also - [Logging Documentation]({{ site.baseurl }}/wiki/logging/) - Learn how to monitor the resampling process - [Installation Guide]({{ site.baseurl }}/installation/) - Ensure FreeSurfer is properly installed - Return to [Wiki]({{ site.baseurl }}/wiki/)",
    "url": "/wiki/atlas-resampling/"
  },
  {
    "title": "Bash Entrypoint",
    "content": "## Installation Steps ### Step 1: Download Required Files **Download the required files:** - **[loader.sh](https://github.com/idossha/TI-toolbox/blob/main/loader.sh)** - Main launch script - **[docker-compose.yml](https://github.com/idossha/TI-toolbox/blob/main/docker-compose.yml)** - Docker configuration ## Usage ### Basic Launch ```bash # Run the script bash loader.sh # Or if made executable ./loader.sh ``` The script will guide you through: 1. **Environment Detection** - Checks Docker availability - Verifies system requirements - Detects platform (Linux/macOS/Windows) 2. **Configuration Setup** - BIDS dataset path selection - Output directory configuration - Resource allocation 3. **Docker Management** - Downloads Docker images (first run) - Starts containers - Manages environment variables When loader program completed: ```bash #Try ebter the core GUI tool GUI # Try enter the pre-processing tool pre-process # Try start the flex-search tool flex-search ``` If these manage to load the CLI you are good to go!",
    "url": "/installation/bash-cli/"
  },
  {
    "title": "Changelog",
    "content": "Complete changelog for all versions of the Temporal Interference Toolbox. --- ### v2.2.2 (Latest Release) **Release Date**: December 25, 2025 #### Additions - - **Simulator Refactoring**: Complete rewrite from bash to Python with modular architecture including progress callbacks, better error handling, and improved logging. - - **Enhanced Cluster Permutation Testing**: New ACES-like correlation investigation, support for continuous variables, enhanced reporting, and improved GUI integration. - - **Comprehensive Testing Infrastructure**: new test files with code coverage integration, headless operation support, and improved CI/CD pipeline. - - **Improved 3D Visualization**: Enhanced visual exporter with automatic electrode placement, metadata extraction, GLB format export, and Docker-based Blender integration. - - **Pythonic CLI Migration**: New Click-based command-line interfaces for simulator and cluster permutation tools with better argument validation. - - **GUI Enhancements**: Improved threading across all tabs with real-time progress updates, better error handling, and enhanced responsiveness. #### Fixes - - **Various Bug Fixes**: Fixed silent timeout issues in CI, corrected coverage integration, improved error handling in all major modules, better cleanup of temporary files, and enhanced logging. - - **Windows Electron**: A more robust executable delivery on Windows. #### Download Links **Desktop App (v2.2.2):** [macOS Intel](https://github.com/idossha/TI-toolbox/releases/download/v2.2.2/TI-Toolbox-x64.dmg) 路 [macOS Apple Silicon](https://github.com/idossha/TI-toolbox/releases/download/v2.2.2/TI-Toolbox-arm64.dmg) 路 [Windows](https://github.com/idossha/TI-toolbox/releases/download/v2.2.2/TI-Toolbox-Setup.exe) 路 [Linux AppImage](https://github.com/idossha/TI-toolbox/releases/download/v2.2.2/TI-Toolbox.AppImage) 路 [Linux deb](https://github.com/idossha/TI-toolbox/releases/download/v2.2.2/ti-toolbox.deb) **Other:** - Docker Image: `docker pull idossha/simnibs:v2.2.2` - Source Code: [GitHub Repository](https://github.com/idossha/TI-Toolbox) --- ### v2.2.1 **Release Date**: December 04, 2025 #### Backward compatibility change to be aware: - **Electode Mapping**: We changed the mapping functionality from the **flex-seach** to the **simulator**. This to provide a more flexible and dynamic framework. Now, the flex-search outputs the: `electrode_positions.json` file and the mapping functionality happeneds on the simulator side using the new method `ti-toolbox/tools/map_electrodes.py`. Thus, one can use a single flex-search to conveniently map to multiple nets. #### Additions - **Desktop App**: Recognizing the importance of Desktop delivery, we redesign our executables with Electron. For more info please see `package`. - **Benchmarks**: Added benchmarking tool with sensible defaults that users can run on their systems - **AMV**: Improved automatic montage visualization that now supports all available nets with a higher resolution image. - **Flex-search**: Added more control over electrode geometry now supporting rectengular and width control. - **Flex-search**: Exapnded hyper-parameter control. tolerance and mutation rate. - **Ex-search**: Enhanced the ex-search with current ratio optimization, enabling more robust optimization process. The exhaustive search now evaluates possible electrode montages and current ratios according to the formula: $N_\\text{total} = N_\\text{elec}^4 \\cdot N_\\text{current}$, where $N_\\text{current} = \\{(I_1,I_2) \\mid I_1+I_2=I_\\text{total} \\wedge I_\\text{step} \\leq I_1,I_2 \\leq I_\\text{limit}\\}$. #### Fixes - **Various Bug Fixes**: protection overwrites, documentation, output formatting, UI improvements, parallel processing, electrode management #### Download Links **Desktop App (v2.2.1):** [macOS Intel](https://github.com/idossha/TI-toolbox/releases/download/v2.2.1/TI-Toolbox-x64.dmg) 路 [macOS Apple Silicon](https://github.com/idossha/TI-toolbox/releases/download/v2.2.1/TI-Toolbox-arm64.dmg) 路 [Windows](https://github.com/idossha/TI-toolbox/releases/download/v2.2.1/TI-Toolbox-Setup.exe) 路 [Linux AppImage](https://github.com/idossha/TI-toolbox/releases/download/v2.2.1/TI-Toolbox.AppImage) 路 [Linux deb](https://github.com/idossha/TI-toolbox/releases/download/v2.2.1/ti-toolbox.deb) **Other:** - Docker Image: `docker pull idossha/simnibs:v2.2.1` - Source Code: [GitHub Repository](https://github.com/idossha/TI-Toolbox) --- ### v2.2.0 **Release Date**: November 07, 2025 #### Additions - **Core Infrastructure & Architecture**: The project underwent a complete restructure, removing old launcher directories and consolidating to a unified ti-toolbox structure. A new core module system was introduced in ti-toolbox/core/ with reusable components including paths.py, calc.py, constants.py, errors.py, process.py, utils.py, nifti.py, mesh.py, and viz.py. The project moved away from executable compilation and now focuses exclusively on bash entry point. - **GUI Extensions System**: A new modular extension system was introduced in ti-toolbox/gui/extensions/ providing several powerful tools. The Cluster-Based Permutation Testing (CBP) extension offers statistical analysis for group comparisons. Nilearn Visuals enables brain visualization using nilearn with glass brain views, surface plots, and slices. The NIfTI Group Averaging tool allows averaging multiple NIfTI files across subjects. The Visual Exporter provides export capabilities to Blender-compatible formats (PLY, STL) with a full tutorial. Additional extensions include Quick Notes for in-app note-taking with persistence, Subject Info Viewer for displaying metadata and processing status, and an Electrode Placement Tool for interactive electrode positioning. - **3D Visualization & Export**: A 3D Exporter module was added in ti-toolbox/3d_exporter/ containing four specialized tools. TI_quick_volumetric.py provides fast volumetric field exports, cortical_regions_to_ply.py handles region-specific mesh exports, cortical_regions_to_stl.py outputs STL format for 3D printing, and vector_ply.py enables vector field visualization in Blender. - **MOVEA Optimization**: MOVEA-like integration was implemented for multi-objective optimization of electrode placement. The system now uses a centralized leadfield with unified leadfield target locations across all optimization tools. A complete MOVEA GUI tab provides an interface for optimization workflows. - **Analysis Tool**: Group Analyzer received significant improvements including enhanced multi-subject analysis capabilities with MNI coordinate support. - **Statistics Module**: A statistics package was created in ti-toolbox/stats/. The cluster_permutation.py module implements non-parametric cluster-based permutation testing. - **Simulator Improvements**: The simulator received substantial enhancements including a new free-hand mode that allows direct electrode coordinate input without montage selection. The entire simulator was refactored for a cleaner codebase with better error handling. - **Optimization Tools**: The flex-search tool was restructured and modularized into ti-toolbox/opt/flex/. A multi-start approach was implemented allowing multiple iterations to find the best solution. The ex-search tool received enhancements for better ROI handling and faster analysis. - **GUI Enhancements**: Multiple GUI improvements enhance the user experience. A centralized Path Manager handles path operations across all GUI tabs. Console output was standardized for consistent logging and status updates. Confirmation dialogs now appear before long-running processes. A debug mode provides optional verbose output for troubleshooting. An OpenGL fallback system provides automatic compatibility handling for macOS issues. - **Documentation**: More documentation was added covering new features. New wiki pages document cluster permutation testing, electrode placement, MOVEA optimization, tissue analyzer, visual exporter, nilearn visuals, nifti group averaging, and quick notes. A pipeline flow diagram provides visual representation of the complete workflow. A detailed Blender tutorial offers step-by-step guidance for 3D visualization. Installation documentation was streamlined with updated setup instructions and removal of executable references. The gallery was updated with new screenshots showcasing all GUI features. - **CI/CD & Testing**: A CI/CD pipeline was implemented with automated testing and Codecov integration for code coverage tracking. The test suite was expanded covering most modules, including new test files for calc, constants, core integration, mesh, errors, ex-analyzer, nifti, paths, process, utils, and MOVEA optimizer with integration tests. CircleCI integration now provides automated testing on every commit with proper permissions and workflows. - **Development Tools**: Developer experience was improved with enhanced dev environment setup in dev/bash_dev/ for contributors. Version control management was improved for better consistency across all files. The project standardized on the simnibs_python interpreter for all Python operations. Container communication between FreeSurfer and SimNIBS was enhanced for better data sharing. #### Fixes - **Bug Fixes & Refinements**: Numerous bug fixes and refinements were implemented including BIDS structure compliance improvements, resolution of deadlock issues in GUI tabs, improved overwrite protection across all tools, fixed electrode naming consistency, better handling of network volumes, X11 and OpenGL fixes for cross-platform compatibility, and reduced console bloat with improved logging throughout the application. - **Removals & Cleanup**: Significant cleanup was performed removing all executable launcher code (over 7,000 lines), eliminating old MATLAB dependencies, removing outdated documentation and assets, cleaning up redundant development files. #### Download Links - Docker Image: `docker pull idossha/simnibs:v2.2.0` - **[loader.sh](https://github.com/idossha/TI-toolbox/blob/main/loader.sh)** - Main launch script - **[docker-compose.yml](https://github.com/idossha/TI-toolbox/blob/main/docker-compose.yml)** - Docker configuration --- ### v2.1.3 **Release Date**: October 08, 2025 #### Additions - - **Executable Launcher**: pre-flight check for existing containers to avoid start conflicts. - - **Executable Launcher**: validation of path input (for mannual inputs) - - **Flex-search**: dynamic focality thresholding for better output - - **Development**: Added a watchdog for easier GUI development - - **Analyzer**: Added `labeling.nii.gz` as an option for voxel analysis w/o need for recon-all #### Fixes - - **General**: Removed env limits for flex-search, cleaned up GUI tabs, fixed Gmsh GUI lauchner with analysis visuals, fixed example data (ernie, MNI152) mounting in executable mode, clean up of executable console output. - - **Critical**: Batch processing of sub-cortical targets in flex-search mode. Previous, `labeling.nii.gz` was no updating between subjects, causing incorrect optimization targeting. #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.3/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.3/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.3/TemporalInterferenceToolbox-Linux-x86_64.AppImage) --- ### v2.1.2 **Release Date**: September 08, 2025 #### Additions - Example Dataset: Toolbox now ships with Ernie & MNI152 MRI scans for quick start & learning purposes. - Tissue Analyzer: Added skin thickness and volume analysis #### Fixes - Various bug fixes: charm, ex-search, flex-search #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.2/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.2/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.2/TemporalInterferenceToolbox-Linux-x86_64.AppImage) --- ### v2.1.1 **Release Date**: August 28, 2025 #### Additions - N/A #### Fixes - **ex-search**: fixed final.csv output - **flex-search**: fixed cleanup of directory if users choose a single start #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.1/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.1/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.1/TemporalInterferenceToolbox-Linux-x86_64.AppImage) --- ### v2.1.0 **Release Date**: August 25, 2025 #### Additions - **Improved BIDS formatting:** Enhanced Brain Imaging Data Structure (BIDS) compliance and formatting for better data - organization and compatibility - **Debug mode for console output:** Introduced comprehensive debug mode with detailed console logging for troubleshooting and development - **Inter-individual variability assessment:** New bone analyzer tool integrated into pre-processing pipeline for assessing anatomical variations between subjects - **Multi-start approach for flex-search optimization:** Implemented multi-start optimization strategy to counter local maxima issues in electrode placement optimization #### Fixes - **Removed MATLAB runtime dependency:** Eliminated MATLAB runtime requirement, making the toolbox fully independent and easier to deploy - **mTI bug fixes and upstream integration:** Resolved critical bugs in mTI (multi-channel Temporal Interference) functionality and improved integration with upstream SimNIBS components - **Enhanced X11 handling for macOS:** Improved X11 server integration and display management for better GUI - functionality on macOS systems - **Official rebranding:** Complete renaming from TI-CSC to TI-Toolbox across all components, documentation, and user interfaces #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.0/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.0/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.0/TemporalInterferenceToolbox-Linux-x86_64.AppImage) --- ### v2.0.5 **Release Date**: July 10, 2025 #### Additions - **Group Analysis Features**: Group analysis system with GUI interface, comparison capabilities, and logging - **Focality Measurement**: New focality analysis tools with histogram generation for cortical analysis - **Normal Component Analysis**: Added normal component matrics and visualization - **Enhanced Workflow**: Multiple subject selection for flex-search, new naming conventions #### Fixes - **GUI Stability**: Multiple bug fixes for group analysis GUI, element resizing, console widget consistency, and special character handling - **Analysis Accuracy**: Improved histogram generation, ROI comparison plots - **Visualization**: Fixed mesh visualization and updated mesh visualizer functionality #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.5/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.5/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.5/TemporalInterferenceToolbox-Linux-x86_64.AppImage) --- ### v2.0.4 **Release Date**: June 26, 2025 #### Additions - flex-search -> simulator integration. Simulator now recognizes previous flex-searches and allows for simulation of both optimized and mapped electrodes. - system monitor -> added a GUI tab that allows users monitor the activity of processes hapenning within the toolbox #### Fixes - pre-process -> added missing shell for recon-all step - pre-process -> fixed parallalization problem - ex-search redesign -> now is not dependent on MATLAB Runtime, but is fully Python implemented - ex-search -> users can now creat multiple leadfields for the same subject - flex-search -> post processing method for TI envelope direction is implemented #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.4/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.4/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.4/TemporalInterferenceToolbox-Linux-x86_64.AppImage) --- ### v2.0.3 **Release Date**: June 20, 2025 #### Additions - Modified tes_flex_optimization.py to include eeg_net field in the .json - toggle between \"Montage Simulation\" (traditional) and \"Flex-Search Simulation\" with automatic discovery of optimization results and electrode type selection (mapped/optimized/both) - Modified TI.py and pipeline scripts to handle direct XYZ electrode coordinates instead of just electrode names, enabling optimized electrode positioning from flex-search results #### Fixes - N/A #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.3/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.3/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.3/TemporalInterferenceToolbox-Linux-x86_64.AppImage) --- ### v2.0.2 **Release Date**: June 19, 2025 #### Additions - Enhanced X11 support for Windows with automatic host IP detection and VcXsrv/Xming configuration guidance - Created `windows_x11_setup.sh` helper script for simplified Windows X server setup - Added comprehensive Windows BIDS path guide (`WINDOWS_BIDS_PATH_GUIDE.md`) with troubleshooting tips - Improved cross-platform X11 configuration with better error handling and user guidance - Added OpenGL software rendering flags for better GUI compatibility across all platforms #### Fixes - Fixed volume mounting in docker-compose.yml - all required volumes now properly mounted to simnibs container - Fixed Windows path handling - automatic conversion of backslashes to forward slashes for Docker compatibility - Fixed paths with spaces on Windows - automatic quoting of paths containing spaces - Fixed X11 socket mounting for macOS XQuartz and Linux compatibility - Fixed DISPLAY environment variable configuration for Windows, macOS, and Linux - Fixed MATLAB Runtime library paths in container environment - Updated XQuartz version warning to reference memory about v2.7.7 compatibility requirement #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.2/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.2/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.2/TemporalInterferenceToolbox-Linux-x86_64.AppImage) --- ### v2.0.1 **Release Date**: June 11, 2025 #### Additions - new logger and report generators under 'projectDIR/derivatives/' - sub-cortical atlas based targeting for flex-search (example: thalamus targeting) #### Fixes - 2 decimal spherical ROIs - 'TI.py' overwrite protection removed - intenral 185 EGI net (removed 2 missed electrodes) - added imagemagick for montage visualizer #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.1/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.1/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.1/TemporalInterferenceToolbox-Linux-x86_64.AppImage) --- ### v2.0.0 **Release Date**: May 28, 2025 #### Major Changes - Complete rewrite of the Temporal Interference Toolbox with major enhancements: Cross-platform support for Windows, macOS, and Linux - Docker-based containerization for consistent environment and reproducibility - Dual interface with both GUI and CLI support, enabling local and remote server usage - Key functionalities include DICOM to NIfTI conversion, FreeSurfer segmentation, SimNIBS head modeling, flexible and exhaustive electrode optimization algorithms, FEM-based temporal interference field calculations, and comprehensive analysis tools with atlas-based ROI evaluation #### Installation - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.0/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.0/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.0/TemporalInterferenceToolbox-Linux-x86_64.AppImage) --- ## Version Support We actively support and maintain versions 2.x.x and newer of the Temporal Interference Toolbox. Versions 1.x.x are no longer supported. ## Getting Help If you encounter issues with any release: 1. Check the [Installation Guide]({{ site.baseurl }}/installation/) for setup instructions 2. Review the [Troubleshooting]({{ site.baseurl }}/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/changelog/"
  },
  {
    "title": "Cluster-Based Permutation Testing",
    "content": "The Cluster-Based Permutation Testing extension performs non-parametric statistical analysis to identify brain regions with significant relationships between temporal interference (TI) stimulation fields and behavioral/clinical outcomes. This method provides robust control of family-wise error rates for both **group comparison** (binary outcomes) and **correlation analysis** (continuous outcomes). ## Key Features - **Dual Analysis Modes**: Group comparison (responders vs non-responders) and correlation analysis (continuous outcomes) - **Non-parametric Statistics**: No assumptions about data distribution - **Family-wise Error Control**: Cluster-level correction for multiple comparisons - **BIDS Integration**: Automatic data discovery and organization - **Flexible Study Designs**: Binary classification or dose-response relationships - **Parallel Processing**: Multi-core support for fast computation - **Comprehensive Output**: Statistical maps, cluster analysis, and detailed reports ## Theoretical Background ### Why Cluster-Based Permutation Testing? Traditional voxelwise statistical tests performed at each brain voxel create a massive multiple comparisons problem. With ~1,000,000 voxels in a typical brain analysis, even a 5% false positive rate would yield 50,000 false discoveries. Cluster-based permutation testing addresses this by: 1. Performing voxelwise statistics (t-values or correlations) 2. Forming clusters of adjacent significant voxels 3. Using cluster statistics (mass or size) instead of individual voxels 4. Building null distributions through data permutations 5. Controlling family-wise error at the cluster level ### Analysis Methods #### Group Comparison (Binary Outcomes) **Traditional Approach**: Compare electric field distributions between responders and non-responders. - **Statistical Test**: Two-sample t-test at each voxel - **Permutation Strategy**: Randomly reassign subjects to responder/non-responder groups - **Null Hypothesis**: No difference in electric field strength between groups - **Use Case**: Clinical trials with binary outcomes (response vs non-response) #### Correlation Analysis (Continuous Outcomes) **ACES Approach**: Identify brain regions where electric field strength correlates with continuous outcome measures. - **Statistical Test**: Pearson/Spearman correlation at each voxel - **Permutation Strategy**: Randomly shuffle outcome measures across subjects - **Null Hypothesis**: No association between electric field strength and outcome - **Use Case**: Dose-response studies with continuous measures (effect sizes, behavioral scores) ### Method Implementation Both methods follow the Maris & Oostenveld (2007) framework with method-specific adaptations: #### Group Comparison Workflow: 1. **Voxelwise Testing**: Compute t-statistics comparing group means 2. **Cluster Formation**: Threshold at p ## Technical Details ### Data Requirements - **File Format**: NIfTI files in MNI space - **File Pattern**: Default `grey_{simulation_name}_TI_MNI_MNI_TI_max.nii.gz` - **Data Type**: Electric field magnitude values - **Analysis Types**: Both classification and correlation approaches supported ### CSV-Based Configuration #### Classification Mode CSV Create `subjects_classification.csv`: ```csv subject_id,simulation_name,response 001,HIPP_L,1 002,HIPP_L,0 003,HIPP_R,1 004,HIPP_R,0 ``` - `response`: 1 = Responder, 0 = Non-Responder #### Correlation Mode CSV Create `subjects_correlation.csv`: ```csv subject_id,simulation_name,effect_size,weight 001,HIPP_L,0.85,1.0 002,HIPP_L,0.72,0.8 003,HIPP_R,0.91,1.0 004,HIPP_R,0.65,1.2 ``` - `effect_size`: Continuous outcome measure (e.g., effect size, % improvement) - `weight`: Optional subject-specific weight (e.g., sample size, reliability measure) ### Statistical Implementation #### Classification Analysis - **Test**: Two-sample t-test (paired or unpaired) - **Permutations**: Random group reassignment - **Cluster Correction**: Family-wise error control at cluster level #### Correlation Analysis - **Test**: Pearson or Spearman correlation - **Permutations**: Random outcome measure shuffling - **Cluster Correction**: Family-wise error control at cluster level - **Weights**: Optional weighted correlation analysis ## References ### General Methodology - **Maris, E., & Oostenveld, R.** (2007). Nonparametric statistical testing of EEG-and MEG-data. *Journal of Neuroscience Methods*, 164(1), 177-190. - **Nichols, T. E., & Holmes, A. P.** (2002). Nonparametric permutation tests for functional neuroimaging: a primer with examples. *Human Brain Mapping*, 15(1), 1-25. - **Winkler, A. M., et al.** (2014). Permutation inference for the general linear model. *NeuroImage*, 92, 381-397. ### Group Comparison (Classification) - **Bullmore, E. T., et al.** (1999). Global, voxel, and cluster tests, by theory and permutation, for a difference between two groups of structural MR images of the brain. *IEEE Transactions on Medical Imaging*, 18(1), 32-42. ### Correlation Analysis (ACES) - **Sack, A. T., et al.** (2021). ACES: Automated Correlation of Electric field Strength and Stimulation effects. *bioRxiv*. [Preprint] - **Bikson, M., et al.** (2021). Rational and irrational approaches to transcranial electrical stimulation. *Clinical Neurophysiology*, 132(10), 2189-2196. - **Huang, Y., et al.** (2019). Measurements and models of electric fields in the in vivo human brain during transcranial electric stimulation. *eLife*, 8, e38834.",
    "url": "/wiki/cluster-permutation-testing/"
  },
  {
    "title": "Dependencies",
    "content": "**1. Docker** is required for running the TI Toolbox containerized environment. Windows/macOS: Install [Docker Desktop](https://www.docker.com/products/docker-desktop/) Linux: Install [Docker Engine](https://docs.docker.com/engine/install/) using your distribution's package manager. Post-Installation Configuration: - Open Docker Desktop settings - Go to \"Resources\" - Allocate at least **32GB RAM** (recommended) - Ensure you have at sufficient free disk space ![Docker Settings on Apple]({{ site.baseurl }}/assets/imgs/installation/docker_resource.png){:style=\"max-width: 350px;\"} --- **2. X Server** Optional, if GUI is desired. **macOS:** Install **[XQuartz 2.7.7](https://www.xquartz.org/releases/archive.html)** 锔 **Important**: XQuartz version 2.7.7 is required for proper OpenGL functionality. Higher versions may cause OpenGL rendering issues. **Setup Steps:** 1. Download and install XQuartz 2.7.7 2. Log out and log back in (required for X11 initialization) 3. Launch XQuartz from Applications > Utilities 4. XQuartz will be configured automatically by TI Toolbox **Windows**: Install **[VcXsrv](https://sourceforge.net/projects/vcxsrv/)** 锔 **Do not use Xming** - it has compatibility issues with the TI Toolbox. **Configuration:** 1. Launch XLaunch from the Start Menu 2. Select \"Multiple windows\" 3. Select \"Start no client\" 4. **Important**: Check \"Disable access control\" 5. Keep VcXsrv running while using TI Toolbox **Linux**: X11 is usually pre-installed on most Linux distributions. **If GUI doesn't appear:** ```bash xhost +local:docker ``` --- ## System Requirements ### Minimum Requirements - **RAM**: 32GB minimum (recommended for full functionality) - **Storage**: At least 30GB free space for Docker images - **Administrative privileges**: Required for initial setup ## Verification ### Test Docker Installation ```bash # Check Docker version docker --version # Test Docker functionality docker run hello-world ``` ### Test X Server - **macOS**: Launch XQuartz and verify it runs without errors - **Windows**: Launch VcXsrv and ensure it's running in system tray - **Linux**: Run `echo $DISPLAY` to verify X11 is configured --- **Next Steps**: Once dependencies are installed, proceed to your platform-specific installation guide: - [Windows Installation](../windows/) - [macOS Installation](../macos/) - [Linux Installation](../linux/)",
    "url": "/installation/dependencies/"
  },
  {
    "title": "Desktop Application",
    "content": "The TI-Toolbox Desktop Application is an Electron-based launcher that provides a user-friendly interface for running the Docker-based TI-Toolbox workflow across macOS, Windows, and Linux platforms. ## Architecture Overview ![TI-Toolbox Desktop App Architecture](../assets/imgs/electron-architecture.svg) ## Components ### Electron Application The desktop app follows a standard Electron architecture with two main processes: #### **Renderer Process** (Frontend) The user interface layer built with HTML, CSS, and JavaScript: - `index.html` - Main UI markup - `styles.css` - Application styling - `renderer.js` - UI logic and event handling **Key Features:** - Project directory selection and validation - Docker status monitoring - Launch and stop controls with progress feedback - Real-time activity log display - Platform-specific warnings and instructions #### **Main Process** (Backend) The Node.js backend that orchestrates all system operations: - `main.js` - Application entry point and window management - `docker-manager.js` - Docker lifecycle control and API integration - `env.js` - Environment setup (DISPLAY, timezone, xhost permissions) - `project-service.js` - BIDS project validation and initialization - `config-store.js` - User preferences persistence - `logger.js` - Structured logging with electron-log **Communication:** The renderer and main processes communicate via Electron's IPC (Inter-Process Communication) mechanism, enabling secure and efficient message passing. ### Docker Integration The app uses a dual approach for Docker integration: 1. **dockerode** - Docker Engine API client for: - Health checks (`docker version`, `docker.ping()`) - Container discovery and inspection - GUI process execution within containers - Real-time log streaming 2. **docker compose CLI** - For multi-container orchestration: - Building and starting the FreeSurfer and SimNIBS containers - Managing volumes and networks - Graceful shutdown and cleanup The `docker-compose.yml` file is bundled with the application in `package/docker/`, ensuring the launcher works independently of the source repository. ## Launch Workflow 1. **User clicks \"Launch TI-Toolbox\"** 2. **Docker availability check** - Verifies Docker Desktop is running 3. **Project initialization** - Creates BIDS structure if new project 4. **Platform setup** - Configures X11 display (XQuartz/VcXsrv/native) 5. **Volume creation** - Sets up persistent Docker volumes 6. **Container startup** - Launches docker-compose services 7. **GUI execution** - Starts TI-Toolbox PyQt5 interface 8. **Active session** - User interacts with the GUI 9. **Cleanup** - Stops containers and reverts X11 permissions on exit ## Platform-Specific Configuration ### macOS - **X Server:** XQuartz - **Display:** `host.docker.internal:0` - **Setup:** `xhost +localhost` for container access ### Linux - **X Server:** Native X11 - **Display:** `:0` (or from `$DISPLAY`) - **Setup:** `xhost +local:docker` for container access ### Windows - **X Server:** VcXsrv or Xming - **Display:** `host.docker.internal:0` - **Path conversion:** Windows paths converted to Docker-compatible format ## IPC Events **Renderer  Main:** - `select-directory` - Opens directory picker - `check-docker` - Verifies Docker availability - `start-toolbox` - Launches the full stack - `stop-toolbox` - Stops all containers - `get-log-path` - Returns log file location - `reveal-log-file` - Opens log in file manager **Main  Renderer:** - `launcher-progress` - Status updates (stage, message, timestamp) - `launcher-log` - GUI process output stream ## Building the Application The app uses `electron-builder` to create platform-specific distributables: **macOS:** `.app` bundle, `.dmg` installer, `.zip` archive **Windows:** `.exe` installer (NSIS), portable `.exe` **Linux:** `.AppImage`, `.deb` package Build commands: ```bash npm run build:mac # macOS only npm run build:win # Windows only npm run build:linux # Linux only npm run build:all # All platforms ``` ## Development Run in development mode with console access: ```bash cd package npm install npm start ``` ## Dependencies **Runtime:** - Docker Desktop (required) - X Server (platform-specific: XQuartz, VcXsrv, or native) **Development:** - Node.js 18+ - npm 9+ ## Security - **X11 Permissions:** Temporarily granted for container access, reverted on exit - **Docker Access:** Uses user's existing Docker installation, no elevated privileges - **Code Signing:** macOS builds include entitlements for JIT compilation (required for Python) ## Performance - **Startup Time:** ~3 seconds for container initialization - **Memory Usage:** ~200MB (app) + Docker containers - **Disk Space:** ~50MB (app) + ~5GB (Docker images) ## Troubleshooting **Docker not found:** Ensure Docker Desktop is installed and running. **X Server issues:** - macOS: Install XQuartz and enable \"Allow connections from network clients\" - Windows: Install VcXsrv with \"Disable access control\" option - Linux: Verify X11 is running and accessible **Permission errors:** Check that your user has access to the Docker daemon (usually requires membership in the `docker` group on Linux). ## See Also - [Installation Guide](../installation/installation.md) - [Quick Start](../../package/QUICK_START.md) - [Architecture Details](../../package/ARCHITECTURE.md)",
    "url": "/wiki/desktop-app/"
  },
  {
    "title": "Electrode Mapping",
    "content": "# Electrode Mapping Tool ## Overview The `map_electrodes.py` tool maps optimized electrode positions to the nearest available positions in an EEG net using the Hungarian algorithm (linear sum assignment) for optimal matching. ## Usage ### Basic Usage ```bash simnibs_python map_electrodes.py -i electrode_positions.json -n EGI_template.csv -o electrode_mapping.json ``` ### With Verbose Output ```bash simnibs_python map_electrodes.py -i electrode_positions.json -n EGI_template.csv -o electrode_mapping.json -v ``` **Note:** This tool requires `simnibs_python` (SimNIBS's bundled Python environment). If running outside Docker, ensure SimNIBS is properly installed and in your PATH. ## Arguments - `-i, --input`: Path to `electrode_positions.json` file containing optimized positions (required) - `-n, --net`: Path to EEG net CSV file containing electrode positions (required) - `-o, --output`: Output path for mapping result JSON file (default: `electrode_mapping.json`) - `-v, --verbose`: Print detailed mapping summary ## Input Format ### electrode_positions.json ```json { \"optimized_positions\": [ [-85.61, -29.00, -8.56], [72.81, -44.38, -16.95] ], \"channel_array_indices\": [ [0, 0], [0, 1] ] } ``` ### EEG Net CSV The tool supports multiple CSV formats commonly used in neuroimaging: **SimNIBS format:** ```csv Type,X,Y,Z,Name,Extra Electrode,-85.5,-28.9,-8.4,E1, ReferenceElectrode,0.0,85.0,0.0,REF, ``` **Simple format:** ```csv Label,X,Y,Z E1,-85.5,-28.9,-8.4 E2,72.9,-44.5,-17.1 REF,0.0,85.0,0.0 ``` **Notes:** - The tool automatically detects the format based on the first column - Only `Electrode` and `ReferenceElectrode` types are included (Fiducials are ignored) - Empty lines and lines starting with `#` are skipped ## Output Format The tool generates a JSON file with the following structure: ```json { \"optimized_positions\": [ [-85.61, -29.00, -8.56], [72.81, -44.38, -16.95] ], \"mapped_positions\": [ [-85.5, -28.9, -8.4], [72.9, -44.5, -17.1] ], \"mapped_labels\": [\"E1\", \"E2\"], \"distances\": [0.15, 0.12], \"channel_array_indices\": [[0, 0], [0, 1]], \"eeg_net\": \"EGI_template.csv\" } ``` ## Features - **Optimal Assignment**: Uses the Hungarian algorithm to find the globally optimal mapping that minimizes total distance - **Detailed Reporting**: With `-v` flag, provides detailed summary including per-electrode distances - **Flexible Input**: Supports multiple CSV formats commonly used in neuroimaging - **Error Handling**: Validates input files and provides clear error messages ## Integration with TI-Toolbox This tool is automatically called by the flex-search optimization when the \"Run simulation with mapped electrodes\" option is enabled in the GUI. It can also be used standalone for post-hoc analysis or custom workflows. ## Example Workflow 1. Run flex-search optimization to generate `electrode_positions.json` 2. Use this tool to map to your specific EEG net: ```bash simnibs_python map_electrodes.py \\ -i output/electrode_positions.json \\ -n path/to/your/EEG_net.csv \\ -o output/electrode_mapping.json \\ -v ``` 3. Use the mapped positions for simulation or analysis ## Notes - If there are more optimized electrodes than available net positions, only the first N electrodes (where N = number of net positions) will be optimally mapped. Extra optimized electrodes will be ignored. - Distances are reported in millimeters - The tool preserves the channel and array indices from the optimization for downstream processing",
    "url": "/wiki/electrode-mapping/"
  },
  {
    "title": "Electrode Placement",
    "content": "The Electrode Placement extension provides an interactive 3D tool for freely placing electrode on head surfaces. This tool is designed for precise and flexible electrode positioning and is heavily inspired by SimNIBS's GUI apporach. ## Key Features - **3D Surface Visualization**: Fast loading and rendering of head surfaces from SimNIBS m2m directories - **Interactive Placement**: Double-click to place electrode markers directly on the 3D surface - **EEG Cap Integration**: Load and visualize EEG electrode positions from CSV files - **Color-Coded Pairs**: Automatic electrode pair coloring (E1卤, E2卤, E3卤, etc.) for easy identification - **Real-time Editing**: Modify electrode coordinates numerically with live 3D updates - **Export Functionality**: Save electrode configurations to JSON for stimulation planning - **OpenGL Rendering**: Smooth 3D manipulation with rotation, zoom, and translation controls ## Usage Workflow ### Getting Started 1. **Launch Extension**: Settings  Extensions  \"Electrode Placement\" 2. **Select Subject**: Choose from available subjects in your project directory 3. **Load Surface**: The extension automatically loads the head mesh from the subject's m2m directory 4. **Optional: Load EEG Cap**: Import reference electrode positions from CSV files ### Electrode Placement 1. **Navigate**: Use mouse controls to rotate, zoom, and translate the 3D view 2. **Place Markers**: Double-click on the head surface to place electrode markers 3. **Automatic Naming**: Electrodes are automatically named with polarity (E1+, E1-, E2+, E2-, etc.) 4. **Color Coding**: Each electrode pair receives a distinct color for visual organization ![Freehand Electrode Placement]({{ site.baseurl }}/assets/imgs/wiki/electrode-placement/freehand.png) *Figure: Interactive 3D electrode placement interface showing freehand positioning on head surface* ### Coordinate Management 1. **View Coordinates**: All placed electrodes appear in the table with X, Y, Z coordinates 2. **Edit Coordinates**: Double-click coordinate cells to modify positions numerically 3. **Delete Electrodes**: Use checkboxes to select and delete multiple electrodes 4. **Real-time Updates**: Changes in the table immediately update the 3D visualization ## Data Formats ### EEG Cap CSV Format The extension supports EEG cap files in CSV format with the following structure: ```csv electrode_type,X,Y,Z,electrode_name EEG,85.2,-12.8,45.6,Fp1 EEG,92.1,15.3,42.8,Fp2 EEG,78.9,-45.2,38.1,C3 ``` **Requirements:** - Comma or tab-separated values - Columns: electrode_type, X, Y, Z, electrode_name - Coordinates in millimeters (SimNIBS coordinate system) - No header row required ### Export Configuration JSON Electrode configurations are exported in a structured JSON format: ```json { \"name\": \"custom_electrode_config\", \"type\": \"U\", \"electrode_positions\": { \"E1+\": [85.2, -12.8, 45.6], \"E1-\": [92.1, 15.3, 42.8], \"E2+\": [78.9, -45.2, 38.1], \"E2-\": [88.4, -38.7, 41.3] } } ``` **Fields:** - `name`: Configuration identifier - `type`: Stimulation type (\"U\" for unipolar, \"M\" for multipolar) - `electrode_positions`: Dictionary mapping electrode names to [X, Y, Z] coordinates ### File Structure ``` subject_m2m_dir/  subject.msh # Head mesh file (loaded automatically)  stim_configs/  electrode_config.json # Exported configurations ```",
    "url": "/wiki/electrode-placement/"
  },
  {
    "title": "Ex-Search TI Optimization Pipeline",
    "content": "The Ex-Search module provides a high-performance, exhaustive search approach for Temporal Interference (TI) simulations. The system features unified logging, multiple EEG net support, flexible leadfield management, and optimized computational efficiency. ## Overview Ex-Search implements a true **exhaustive search** approach for Temporal Interference (TI) optimization, systematically evaluating all possible electrode combinations within user-defined constraints. Unlike sampling-based methods, ex-search guarantees finding the globally optimal montage configuration. **Key Features:** - **True Exhaustive Search**: Evaluates all N electrode combinations  current ratios (where N = electrodes per channel) - **Multiple EEG Nets**: Support for high-density (10:10) and 10-20 nets with automatic co-registration - **ROI Analysis**: Spherical ROI definition with configurable radius specification (default 3mm) - **Current Ratio Optimization**: Systematic testing of current ratios respecting channel limits - **High-Performance Processing**: Memory-efficient in-memory calculations with real-time progress tracking - **Comprehensive Metrics**: TImax, TImean, Focality analysis with automatic visualization ## Search Modes Ex-Search supports two electrode assignment strategies: ### Bucketed Mode (Original) Electrodes are pre-assigned to specific channels: - **E1+**: Electrodes for positive channel 1 - **E1-**: Electrodes for negative channel 1 - **E2+**: Electrodes for positive channel 2 - **E2-**: Electrodes for negative channel 2 **Combinations**: N  N  N  N (where N = electrodes per bucket) ### Pooled Mode (New) All electrodes are pooled together and can be assigned to any channel position, with the constraint that each electrode is used only once per montage. **Combinations**: C(N,4)  4! (where N = total electrodes, C = combinations) **Trade-off**: Larger search space and longer compute time but with absolute certainty to find optimal solution with given electrode space. ## User Interface The interface provides controls for: - **Subject Selection**: Choose from available subjects with automatic leadfield scanning - **Leadfield Management**: View existing leadfields, create new ones, and show electrode configurations - **ROI Configuration**: Add target regions with coordinates and manage multiple ROIs - **Electrode Setup**: Configure E1+, E1-, E2+, E2- with support for both GSN and 10-20 formats - **Execution Control**: Run optimization with real-time progress tracking --- ## Supported EEG Nets Ex-Search automatically detects and supports multiple EEG electrode configurations: (EEG nets autoamtically co-registered during pre-processing) EGI 10-20 Okamoto 2004 electrode configuration - widely used standard with 32 electrodes GSN-HydroCel 256 electrode configuration - high-density net for precise targeting --- **Example Results:** | Montage | TImax_ROI | TImean_ROI | TImean_GM | Focality | |---------|------------|------------|-----------|----------| | Fp1_Pz C3_C4 | 0.1748 | 0.1418 | 0.1595 | 0.8892 | | Fp1_Pz C3_F4 | 0.2321 | 0.1480 | 0.1723 | 0.8587 | | Fp1_Pz C3_P4 | 0.1632 | 0.1150 | 0.1637 | 0.7025 | | Fp1_Pz F3_C4 | 0.1884 | 0.1558 | 0.1803 | 0.8643 | ![Ex-Search Distribution Analysis]({{ site.baseurl }}/assets/imgs/wiki/ex-search/ex-search_distribution.png) --- ## Pipeline Workflow ### 1. EEG Net Selection ``` [INFO] Scanning available EEG nets for subject 101... 1. EGI10-10_Cutini_2011.csv 2. EGI10-10_UI_Jurak_2007.csv 3. EGI10-20_Okamoto_2004.csv 4. GSN-HydroCel-185.csv # Default selection 5. GSN-HydroCel-256.csv 6. easycap_BC_TMS64_X21.csv ``` ### 2. Leadfield Management - **Intelligent Detection**: Automatic scanning of existing leadfields with HDF5 validation - **Flexible Creation**: Generate leadfields for any supported EEG net with automated naming - **Performance Optimization**: Efficient loading of large matrices (2-20GB) with memory monitoring ### 3. Current Ratio Optimization The optimization systematically tests current ratios respecting channel limits: ``` For total_current=2.0mA, step=0.2mA, limit=1.6mA: (1.6, 0.4), (1.4, 0.6), (1.2, 0.8), (1.0, 1.0), (0.8, 1.2), (0.6, 1.4), (0.4, 1.6) ``` ### 4. Exhaustive Search Algorithm - **Electrode Combinations**: N combinations where N is electrodes per channel group - **Current Ratios**: Systematic testing across user-defined current steps - **Total Combinations**: `electrode_combinations  current_ratios` - **In-Memory Processing**: No intermediate mesh files, direct field extraction - **Progress Tracking**: Real-time monitoring with ETA calculations ### 5. Analysis & Visualization Pipeline - **Run Time**: From minutes to hours depending on leadfield size and electrode combinations - **Metrics Calculation**: TImax_ROI, TImean_ROI, TImean_GM, Focality (TImean_ROI/TImean_GM) - **Visualization**: Automatic histogram generation (TImax, TImean, Focality distributions) - **Output Formats**: JSON results, CSV summaries, PNG histograms ## Technical Implementation ### Optimized Processing Architecture The ex-search implementation features several performance optimizations: - **Memory-Efficient Design**: In-memory field calculations eliminate intermediate file I/O - **Itertools Integration**: Uses `itertools.product()` for efficient combination generation instead of nested loops ### Algorithm Efficiency ``` for processed, (e1_plus, e1_minus, e2_plus, e2_minus, current_ratio) in \\ enumerate(product(E1_plus, E1_minus, E2_plus, E2_minus, ratios), 1): # Process combination ``` ### Performance Characteristics - **Scalability**: Handles large electrode combinations (1000+ montages) efficiently - **Memory Usage**: Constant memory footprint regardless of combination count - **Progress Tracking**: Real-time ETA calculation with rate monitoring - **Error Resilience**: Individual combination failures don't halt entire optimization",
    "url": "/wiki/ex-search/"
  },
  {
    "title": "Ex-Search Gallery",
    "content": "Exhaustive Search Results electrode selection is required for exhaustive search optimization All elecrode combinations to be searches through n^4 combniations &times; &#10094; &#10095; .gallery-section { margin: 2rem 0; padding: 1rem; background-color: #f8f9fa; } .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; margin-top: 1rem; } .gallery-item { background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; transition: transform 0.2s ease, box-shadow 0.2s ease; } .gallery-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); } /* Override wiki.css image styles with more specific selectors and !important */ .wiki-content .gallery-item img, .gallery-item img { width: 100% !important; max-width: 500px !important; max-height: 400px !important; height: auto !important; object-fit: contain !important; border-radius: 4px !important; margin-bottom: 0.5rem !important; margin-left: auto !important; margin-right: auto !important; margin-top: 0 !important; display: block !important; box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important; loading: lazy; } .gallery-item p { margin: 0; font-size: 0.9rem; color: #666; line-height: 1.4; } @media (max-width: 768px) { .gallery-grid { grid-template-columns: 1fr; gap: 1rem; } .gallery-section { margin: 1rem 0; padding: 0.5rem; } .wiki-content .gallery-item img, .gallery-item img { max-width: 100% !important; max-height: 300px !important; } } @media (max-width: 480px) { .wiki-content .gallery-item img, .gallery-item img { max-height: 250px !important; } }",
    "url": "/gallery/ex-search/"
  },
  {
    "title": "Extension System",
    "content": "The TI-Toolbox Extension System provides a modular framework for adding new tools and features without modifying the core application codebase. Extensions are self-contained Python scripts that can be easily installed, updated, or removed. ## Architecture ``` tit/gui/  extensions.py # Main extension interface  settings_menu.py # Settings menu with Extensions option  extensions/ # Extension directory  *.py # Individual extension files  ... ``` ## Extension Discovery The system automatically scans the `extensions/` directory for Python files and loads them dynamically: ```python def load_extensions(self): extension_files = list(self.extensions_dir.glob(\"*.py\")) for extension_file in sorted(extension_files): # Load and display extension ``` ## Extension Metadata Each extension must define required metadata constants: ```python EXTENSION_NAME = \"My Extension\" EXTENSION_DESCRIPTION = \"What this extension does\" ``` ## Development ### Creating Extensions Extensions are Python scripts that follow a simple structure: ```python #!/usr/bin/env simnibs_python # -*- coding: utf-8 -*- \"\"\" Extension: My Custom Tool Brief description of what it does. \"\"\" # Required metadata EXTENSION_NAME = \"My Custom Tool\" EXTENSION_DESCRIPTION = \"Detailed description of the tool's purpose\" # Add TI-Toolbox to path import sys from pathlib import Path ti_toolbox_path = Path(__file__).parent.parent.parent sys.path.insert(0, str(ti_toolbox_path)) # Import required modules from core import get_path_manager # Extension implementation def main(parent=None): \"\"\"Main entry point called when extension is launched\"\"\" # Your extension code here pass # Alternative entry point def run(parent=None): \"\"\"Alternative entry point for flexibility\"\"\" main(parent) ``` ### GUI Integration Extensions typically create PyQt5 dialog windows: ```python from PyQt5 import QtWidgets class MyExtensionDialog(QtWidgets.QDialog): def __init__(self, parent=None): super().__init__(parent) self.setWindowTitle(EXTENSION_NAME) self.setup_ui() def setup_ui(self): \"\"\"Set up the user interface\"\"\" layout = QtWidgets.QVBoxLayout(self) # Add your UI components here ``` ### Core Module Access Extensions can import and use TI-Toolbox core modules: ```python from core.paths import Paths from core.utils import Utils from core.constants import Constants from core import get_path_manager ``` ### BIDS Convention Compliance Extensions should respect the TI-Toolbox BIDS directory structure: ``` project_dir/  sub-{id}/  sourcedata/   sub-{id}/  derivatives/  freesurfer/  SimNIBS/  ti-toolbox/ ``` ## Installation and Distribution ### Installing Extensions Extensions are distributed as single Python files. To install: 1. Download the extension `.py` file 2. Place it in `ti-toolbox/gui/extensions/` directory 3. Restart TI-Toolbox or refresh extensions 4. Access via **Settings  Extensions** ### Developing Extensions To contribute new extensions: 1. Follow the extension template structure 2. Implement proper error handling 3. Add comprehensive documentation 4. Test thoroughly across different scenarios 5. Submit a pull request to the TI-Toolbox repository ## Best Practices ### Error Handling Always wrap main logic in try-except blocks: ```python def launch_extension(self): try: module.main(parent=self.parent) except Exception as e: QtWidgets.QMessageBox.critical( self, \"Extension Launch Error\", f\"Failed to launch: {str(e)}\" ) ``` ### Resource Management Clean up resources when extensions close: ```python def closeEvent(self, event): \"\"\"Handle window close event.\"\"\" # Close open files # Stop background threads # Save state if needed event.accept() ``` ### User Feedback Provide clear progress indicators and status messages: ```python # Progress indicators progress = QtWidgets.QProgressBar() # Status messages self.status_label.setText(\"Processing...\") # Completion messages QtWidgets.QMessageBox.information(self, \"Done\", \"Processing complete!\") ```",
    "url": "/wiki/extension/"
  },
  {
    "title": "Flex Search Electrode Optimization",
    "content": "**References:** - [Original Paper: Weise K, Madsen KH, Worbs T, Kn枚sche TR, Korsh酶j A, Thielscher A. A Leadfield-Free Optimization Framework for Transcranially Applied Electric Currents](https://www.sciencedirect.com/science/article/pii/S0010482525009990) - [SimNIBS Implementation: Leadfield-free TES Optimization Tutorial](https://simnibs.github.io/simnibs/build/html/tutorial/tes_flex_opt.html#tes-flex-opt) - [Data Source: Haber I, et al. Quantitative evaluation of transcranial electrical stimulation optimization methods](https://www.biorxiv.org/content/10.1101/2025.10.06.680781v3) ## Overview Flex Search uses differential evolution optimization to determine the best electrode positions for TI stimulation based on: - **Optimization Goals**: Maximize mean field, peak field, or focality (field in ROI / field in non-ROI) - **Post-processing Methods**: Optimize for maximum TI field, normal component, or tangential component - **ROI Definition**: Spherical coordinates, cortical atlas regions, or subcortical structures - **Multi-start Optimization**: Run multiple optimization iterations to ensure robust results ## User Interface The interface provides comprehensive controls for: - **Basic Parameters**: Subject selection, optimization goal, and post-processing method - **Electrode Parameters**: Radius and current settings - **ROI Definition**: Multiple methods for defining target regions - **Stability Options**: Iteration limits, population size, and CPU utilization - **Mapping Options**: EEG net electrode mapping capabilities ## Mean TI Field Optimization Demonstration We demonstrate the effectiveness of flex-search by optimizing electrode positions for the same target ROI using different post-processing methods. The target was the left insula (region 35 of the DK40 atlas) with the goal of maximizing the mean TI field. ### Optimization Setup - **Subject**: 102 - **Target ROI**: Left insula (DK40 atlas, region 35) - **Goal**: Maximize mean field in ROI - **Electrode**: 4mm radius, 8mA current ### Results: Maximum TI Field Optimization Maximum TI field distribution showing optimization results ROI targeting analysis for maximum TI field optimization **Optimization Summary:** | Metric | Value | |--------|--------| | Final Goal Value | -2.320 | | Duration | 25.1 minutes | | Peak Field (99.9%) | 4.17 V/m | | Median ROI Field | 2.21 V/m | ## Focality Optimization with Dynamic Thresholding The focality optimization goal is a multi-objective function balancing ROI targeting with out-of-ROI field minimization: ### Non-ROI Definition Methods - **Everything Else**: Uses the complement of the ROI (everything outside the target region) - **Specific Region**: Define a custom non-ROI using the same methods as ROI definition (spherical, atlas, subcortical) ### Focality Thresholds - Critical for Optimization Success As described in the [original paper](https://www.sciencedirect.com/science/article/pii/S0010482525009990), focality optimization is fundamentally a **constrained multi-objective problem** where: - **Target Region (ROI)**: Field strength must exceed specified thresholds - **Avoidance Region (Non-ROI)**: Field strength must remain below specified thresholds - **Optimization Goal**: Maximize field intensity in ROI while minimizing field spread outside ROI #### Threshold Configuration Options - **Single Threshold**: Binary classification where field must be below threshold in non-ROI and above threshold in ROI - **Dual Thresholds**: Independent thresholds for each region, allowing asymmetric optimization constraints - **Dynamic Adaptation**: Thresholds automatically adjust based on field distribution characteristics during optimization **Focality optimization analysis**: Comparative evaluation of threshold strategies reveals critical insights: threshold selection profoundly impacts results, with relative thresholds (50% of peak) yielding 75% higher focality than fixed thresholds, while 80% thresholds reduce focality by 37%, compared to fixed thresholds (0.1V/m and 0.3V/m) highlighting the importance of threshold optimization for precise neuromodulation. Dynamic % based thresholds were derived automatically from an intial pass of mean TImax search and applied to the upper bound only. The lower bound was kept at 20% from that value. *Data regarding focality thresholds and optimization performance comes from the supplementary information of Haber et al. 2025.* ## Multi-Start Optimization Flex Search supports multi-start optimization to ensure robust and reliable results by running multiple optimization iterations and selecting the best solution: - **Multiple Runs**: Configure the number of optimization runs (default: 1, recommended: 3-5 for critical applications) - **Best Solution Selection**: Automatically selects the optimization run with the lowest function value - **Comprehensive Reporting**: Generates multi-start summary files with run-by-run analysis **Multi-start optimization validation**: Analysis demonstrates that running multiple independent optimizations with different random seeds yields superior solutions compared to single runs; 4.18% improvement in mean TImax. While statistically significant, the modest gains should be weighed against the increased computational cost. *Data regarding multi-start optimization performance comes from the supplementary information of Haber et al. 2025.* ## Electrode Mapping and Target Accessibility The transition from unconstrained optimization solutions to practical electrode montages represents a critical step in clinical translation. While genetic algorithms can identify theoretically optimal electrode positions anywhere on the scalp, its transition to clinical application may be difficult. Our electrode mapping algorithm bridges this gap by finding the best approximation of optimized positions using available electrode sites. For this study, we utilized the inner 185 electrodes of the GSN-HydroCel-256 system (EGI/Philips), which provides high-density coverage. A combinatorial optimization method that solves the assignment problem in polynomial time. By minimizing the total Euclidean distance between optimized and standard positions, this approach ensures good representation of the intended field distribution while maintaining practical feasibility. **Electrode mapping challenges**: Analysis of optimized electrode positions reveals depth-dependent mapping distances across anatomical targets, with subcortical structures like the hippocampus requiring significantly larger electrode separations (11.74 卤 5.33 mm) compared to cortical regions like the insula (7.30 卤 1.38 mm) or spherical ROIs (8.01 卤 1.43 mm). This pattern reflects the fundamental challenge of targeting deep brain structures with scalp electrodes, where optimal montages often requires large distances between electrodes which may be positioned on the lower scalp that does not have dense electrode coverage. *Data regarding electrode mapping distances comes from the supplementary information of Haber et al. 2025.*",
    "url": "/wiki/flex-search/"
  },
  {
    "title": "Flex-Search Gallery",
    "content": "Evolutionary Electrode Optimization Evolutionary optimization showing flexible electrode placement unbound by EEG net. Extention to the flex-search mapping optimized electrodes to nearest avilable EEG electrodes &times; &#10094; &#10095; .gallery-section { margin: 2rem 0; padding: 1rem; background-color: #f8f9fa; } .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; margin-top: 1rem; } .gallery-item { background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; transition: transform 0.2s ease, box-shadow 0.2s ease; } .gallery-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); } /* Override wiki.css image styles with more specific selectors and !important */ .wiki-content .gallery-item img, .gallery-item img { width: 100% !important; max-width: 500px !important; max-height: 400px !important; height: auto !important; object-fit: contain !important; border-radius: 4px !important; margin-bottom: 0.5rem !important; margin-left: auto !important; margin-right: auto !important; margin-top: 0 !important; display: block !important; box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important; loading: lazy; } .gallery-item p { margin: 0; font-size: 0.9rem; color: #666; line-height: 1.4; } @media (max-width: 768px) { .gallery-grid { grid-template-columns: 1fr; gap: 1rem; } .gallery-section { margin: 1rem 0; padding: 0.5rem; } .wiki-content .gallery-item img, .gallery-item img { max-width: 100% !important; max-height: 300px !important; } } @media (max-width: 480px) { .wiki-content .gallery-item img, .gallery-item img { max-height: 250px !important; } }",
    "url": "/gallery/flex-search/"
  },
  {
    "title": "Gallery",
    "content": "# Temporal Interference Toolbox Gallery **Coming Soon** The TI-Toolbox gallery is currently being updated with comprehensive visual examples and documentation. Please check back soon for: - Visual examples of all toolbox modules - Step-by-step workflow demonstrations - Result visualizations and analysis examples - Interactive guides and tutorials In the meantime, explore the individual gallery sections available in the navigation.",
    "url": "/gallery/"
  },
  {
    "title": "Installation",
    "content": "## Option 1: Desktop App Download the pre-built desktop application for your platform from the **[Latest Release](https://github.com/idossha/TI-toolbox/releases/latest)**: | Platform | Download | |----------|----------| | **macOS (Intel)** | `TI-Toolbox-{version}-x64.dmg` | | **macOS (Apple Silicon)** | `TI-Toolbox-{version}-arm64.dmg` | | **Windows** | `TI-Toolbox-Setup-{version}.exe` | | **Linux** | `TI-Toolbox-{version}.AppImage` or `.deb` | Simply download, install, and launch  the app handles Docker management for you. ## Option 2: Command Line (Bash) **Download the required files:** - **[loader.sh](https://github.com/idossha/TI-toolbox/blob/main/loader.sh)** - Main launch script - **[docker-compose.yml](https://github.com/idossha/TI-toolbox/blob/main/docker-compose.yml)** - Docker configuration --- ## Prerequisites (Required for Both Options) - **Docker**: [Docker Desktop](https://www.docker.com/products/docker-desktop/) (Windows/macOS) or [Docker Engine](https://docs.docker.com/engine/install/) (Linux) - **X Server**: XQuartz (macOS), VcXsrv (Windows), or X11 (Linux - usually pre-installed) --- 锔 **Security Notice**: Only run bash scripts and download applications from official sources. For detailed, step-by-step instructions for your platform, use the sidebar navigation.",
    "url": "/installation/"
  },
  {
    "title": "Linux Installation",
    "content": "## Prerequisites ### Docker Engine 1. **Install Docker Engine** following the [official installation guide](https://docs.docker.com/engine/install/) 2. **Start Docker service**: ```bash sudo systemctl start docker sudo systemctl enable docker ``` 3. **Add user to docker group** (optional, avoids using sudo): ```bash sudo usermod -aG docker $USER ``` *Log out and back in for changes to take effect* ### X Server Most Linux distributions come with X11 pre-installed. If you need to install it: - **Ubuntu/Debian**: `sudo apt install xorg` - **Fedora/RHEL**: `sudo dnf install xorg-x11-server-Xorg` (or yum) - **Arch**: `sudo pacman -S xorg-server` ## Option 1: Desktop App Download the pre-built desktop application for your Linux distribution from the **[Latest Release](https://github.com/idossha/TI-toolbox/releases/latest)**: | Format | Download | |--------|----------| | **AppImage** | `TI-Toolbox-{version}.AppImage` | | **Debian/Ubuntu** | `TI-Toolbox-{version}.deb` | Simply download and run the AppImage, or install the .deb package  the app handles Docker management for you. ## Option 2: Command Line ## Setup Steps ### Step 1: Download Required Files Download these files to your preferred location (e.g., `~/TI-Toolbox/`): - **[loader.sh](https://github.com/idossha/TI-toolbox/blob/main/loader.sh)** - **[docker-compose.yml](https://github.com/idossha/TI-toolbox/blob/main/docker-compose.yml)** ### Step 2: Launch TI-Toolbox 1. **Open Terminal** 2. **Navigate to your download location**: ```bash cd ~/TI-Toolbox/ ``` 3. **Make loader.sh executable**: ```bash chmod +x loader.sh ``` 4. **Ensure Docker is running**: ```bash sudo systemctl status docker ``` 5. **Launch TI-Toolbox**: ```bash ./loader.sh ``` 6. **First run will download Docker images (~30GB)** - this may take 30+ minutes ## Distribution-Specific Notes ### Ubuntu/Debian - Follow standard Docker installation instructions - X11 is usually pre-installed *Currently tested primarily on Ubuntu. Please submit an issue if you encounter problems on other distributions.*",
    "url": "/installation/linux/"
  },
  {
    "title": "Logging Processes in the Toolbox",
    "content": "The TI-Toolbox features its very own logging utility that provides a consistent and flexible way to handle logging across all components of the toolbox. This logging system is designed to be both powerful and easy to use, with support for both console and file output. ## Log Files ### Location and Structure Log files are automatically stored in a structured directory hierarchy: ``` project_root/  derivatives/  logs/  sub-{subject_id}/  {component_name}_{timestamp}.log ``` For example: ``` /mnt/projectdir/derivatives/logs/sub-010/analyzer_20250605_231026.log ``` ### Reading Log Files Log files contain detailed information about the execution of various toolbox components. Each log entry follows this format: ``` [2025-06-05 23:10:26] [analyzer.mesh_analyzer] [INFO] Mesh analyzer initialized successfully ``` Breaking down the format: - Timestamp: `[2025-06-05 23:10:26]` - Component: `[analyzer.mesh_analyzer]` - Log Level: `[INFO]` - Message: `Mesh analyzer initialized successfully` ### Log Levels Log entries are categorized by importance: - **INFO**: General information about program execution - **WARNING**: Warning messages for potentially problematic situations - **ERROR**: Error messages for serious problems - **DEBUG**: Detailed information for debugging (not shown by default) ## Real-World Examples ### Process Tracking The logs show the progression of operations: ``` [2025-06-05 23:10:26] [analyzer.mesh_analyzer] [INFO] Starting spherical ROI analysis (radius=5.0mm) at coordinates [-45.0, 0.0, 0.0] [2025-06-05 23:10:26] [analyzer.mesh_analyzer] [INFO] Loading mesh data... [2025-06-05 23:10:26] [analyzer.mesh_analyzer] [INFO] Creating spherical ROI at [-45.0, 0.0, 0.0] with radius 5.0mm... [2025-06-05 23:10:26] [analyzer.mesh_analyzer] [INFO] Found 45 nodes in the ROI [2025-06-05 23:10:26] [analyzer.mesh_analyzer] [INFO] Calculating statistics... [2025-06-05 23:10:26] [analyzer.mesh_analyzer] [INFO] Generating visualizations... ``` ### Results and Statistics Important results and statistics are logged with precise values: ``` [2025-06-05 23:10:26] [analyzer.mesh_analyzer.visualizer] [INFO] Data: 45 nodes, mean=0.032638, max=0.094988, min=0.009335 ``` ### Command Execution External command execution is logged with full details: ``` [2025-06-05 23:10:27] [analyzer.mesh_analyzer] [INFO] Running: msh2cortex -i /mnt/projectdir/derivatives/SimNIBS/sub-010/Simulations/M1/TI/mesh/grey_010_M1_TI.msh -m /mnt/projectdir/derivatives/SimNIBS/sub-010/m2m_010 -o /mnt/projectdir/derivatives/SimNIBS/sub-010/Simulations/M1/TI/mesh ``` ## Features - **Dual Output**: Logs are written to both console and file simultaneously - **Hierarchical Logging**: Support for parent-child logger relationships - **External Logger Integration**: Ability to configure external loggers (e.g., SimNIBS) - **Timestamped Log Files**: Automatic creation of timestamped log files - **Configurable Formats**: Different formats for console and file output - **Log Level Control**: Configurable logging levels - **Bash Script Support**: Includes a bash wrapper for logging in shell scripts ## Environment Variables The logging system respects the following environment variables: - `TI_LOG_FILE`: Custom log file path (optional) - `PROJECT_DIR`: Project root directory (required for default log file location) - `SUBJECT_ID`: Subject identifier (required for default log file location) ## For Developers ### Python Usage ```python from utils.logging_util import get_logger # Create a logger with default settings logger = get_logger('my_component') # Log messages at different levels logger.debug(\"Detailed information for debugging\") logger.info(\"General information about program execution\") logger.warning(\"Warning messages for potentially problematic situations\") logger.error(\"Error messages for serious problems\") ``` ### Bash Usage ```bash # Source the logging utility source utils/bash_logging.sh # Initialize logging init_logging \"my_script\" \"/path/to/logfile.log\" # Log messages log_info \"This is an info message\" log_warning \"This is a warning message\" log_error \"This is an error message\" log_debug \"This is a debug message\" ``` ### Advanced Features #### Child Loggers Create child loggers to maintain a hierarchical logging structure: ```python # Create a parent logger parent_logger = get_logger('parent') # Create a child logger child_logger = parent_logger.getChild('child') ``` The logger name hierarchy is reflected in the log output: ``` [2025-06-05 23:10:26] [parent] [INFO] Parent message [2025-06-05 23:10:26] [parent.child] [INFO] Child message ``` #### External Logger Integration Configure external loggers to use the same logging setup: ```python from utils.logging_util import configure_external_loggers # Configure external loggers to use the same handlers configure_external_loggers(['simnibs', 'mesh_io'], parent_logger) ``` This ensures consistent logging across all components, including third-party libraries. #### Custom Log File Location Specify a custom log file location: ```python logger = get_logger('my_component', log_file='/path/to/custom.log') ``` You can also set the log file path through the `TI_LOG_FILE` environment variable: ```bash export TI_LOG_FILE=\"/path/to/custom.log\" ``` ## Best Practices 1. **Use Descriptive Logger Names**: Name loggers after the component they're used in 2. **Maintain Log Hierarchy**: Use child loggers for sub-components 3. **Appropriate Log Levels**: Use the appropriate log level for each message 4. **Structured Logging**: Include relevant context in log messages 5. **Error Handling**: Always log errors with sufficient context for debugging",
    "url": "/wiki/logging/"
  },
  {
    "title": "macOS Installation",
    "content": "## Prerequisites ### Docker Desktop 1. **Install Docker Desktop** for Mac from [docker.com](https://www.docker.com/products/docker-desktop/) 2. **Start Docker Desktop** and ensure it's running (green indicator in menu bar) ### X Server for GUI Install [XQuartz 2.7.7](https://www.xquartz.org/) for GUI display: - Download and install XQuartz version 2.7.7 from the official website - Log out and back in (or restart) after installation ## Option 1: Desktop App Download the pre-built desktop application for your Mac from the **[Latest Release](https://github.com/idossha/TI-toolbox/releases/latest)**: | Architecture | Download | |--------------|----------| | **Intel/AMD** | `TI-Toolbox-{version}-x64.dmg` | | **Apple Silicon** | `TI-Toolbox-{version}-arm64.dmg` | Simply download, mount the DMG, and drag TI-Toolbox to your Applications folder  the app handles Docker management for you. ## Option 2: Command Line ## Setup Steps ### Step 1: Download Required Files Download these files to your preferred location (e.g., `~/TI-Toolbox/`): - **[loader.sh](https://github.com/idossha/TI-toolbox/blob/main/loader.sh)** - **[docker-compose.yml](https://github.com/idossha/TI-toolbox/blob/main/docker-compose.yml)** ### Step 2: Launch TI-Toolbox 1. **Open Terminal** (Applications > Utilities > Terminal) 2. **Navigate to your download location**: ```bash cd ~/TI-Toolbox/ ``` 3. **Make loader.sh executable**: ```bash chmod +x loader.sh ``` 4. **Launch TI-Toolbox**: ```bash ./loader.sh ``` 5. **First run will download Docker images (~30GB)** - this may take 30+ minutes ## macOS-Specific Features ### Apple Silicon Compatibility - Docker Desktop automatically handles architecture differences between Intel and Apple Silicon - Some performance differences may occur between architectures - All TI-Toolbox features work on both architectures ### Security & Notarization - **Apple Notarization**: The desktop app is notarized by Apple to ensure it's safe and hasn't been tampered with - **Gatekeeper Compatibility**: The app passes macOS Gatekeeper checks, so you won't see security warnings when opening it - **Hardened Runtime**: Uses macOS security features to protect against code injection and other exploits",
    "url": "/installation/macos/"
  },
  {
    "title": "Montage Visualizer",
    "content": "The Montage Visualizer is a tool for creating visual representations of electrode montages on EEG net images. It supports both unipolar and multipolar temporal interference (TI) stimulation configurations. It is automatically integrated as part of the simulation pipeline of the TI-Toolbox. ## Simulation Modes Unipolar montages use **4 electrodes** arranged in **2 channels**. ![Unipolar Montage Example]({{ site.baseurl }}/assets/imgs/wiki/montage_visualizer/unipolar.png) Multipolar montages use **8 electrodes** arranged in **4 channels**. ![Multipolar Montage Example]({{ site.baseurl }}/assets/imgs/wiki/montage_visualizer/multipolar.png) ## Supported EEG Networks - **GSN-HydroCel Systems**: GSN-HydroCel-185.csv, GSN-HydroCel-256.csv - **10-10 Systems**: EEG10-10_UI_Jurak_2007.csv, EEG10-10_Cutini_2011.csv, EEG10-20_Okamoto_2004.csv, EEG10-10_Neuroelectrics.csv ## Visual Features ### Electrode Rings - **Size**: 40px radius rings centered on electrode positions - **Colors**: 8 distinct professional colors (blue, red, green, purple, orange, cyan, chocolate, violet) - **Design**: Hollow circles with 6px stroke width for clear visibility ### Connection Lines - **Style**: Smooth quadratic Bezier curves forming natural arches - **Color**: Matches corresponding electrode ring colors - **Width**: 3px stroke - **Offset**: Lines start/end 15px away from electrode centers to avoid overlap",
    "url": "/wiki/montage_visualizer/"
  },
  {
    "title": "NIfTI Group Averaging",
    "content": "The NIfTI Group Averaging extension provides comprehensive tools for computing group averages and statistical comparisons of NIfTI files organized by experimental groups. This extension is particularly useful for temporal interference (TI) stimulation studies where researchers need to compare field distributions across multiple subjects and experimental conditions. ## Workflow Example ### Basic Group Analysis 1. **Launch Extension**: Settings  Extensions  \"NIfTI Group Averaging\" 2. **Configure Subjects**: - Subject 001: Simulation \"stim_A\", Group \"Treatment\" - Subject 002: Simulation \"stim_A\", Group \"Treatment\" - Subject 003: Simulation \"stim_B\", Group \"Control\" - Subject 004: Simulation \"stim_B\", Group \"Control\" 3. **Set Parameters**: - Analysis name: `treatment_vs_control` - NIfTI pattern: default - Difference pairs: automatic (all pairs) 4. **Run Analysis**: Generate group averages and differences ### Output Structure Results are saved to `derivatives/ti-toolbox/nifti_average/{analysis_name}/`: ``` treatment_vs_control/  average_Treatment.nii.gz # Group average for Treatment  average_Control.nii.gz # Group average for Control  difference_Treatment_minus_Control.nii.gz # Treatment - Control  config.json # Complete analysis configuration  analysis_log.txt # Processing details ``` ## Results Visualization The group difference analysis provides visual output showing statistical comparisons between experimental groups: *Figure: group differences in electric field distributions* ## CSV Configuration Management ### Import Format **Required Columns:** - `subject_id`: Subject identifier (without 'sub-' prefix) - `simulation_name`: Simulation directory name - `group`: Group assignment label **Example CSV:** ```csv subject_id,simulation_name,group 001,HIPP_L_stim,Treatment 002,HIPP_L_stim,Treatment 003,HIPP_R_stim,Control 004,HIPP_R_stim,Control 005,HIPP_L_stim,Treatment ``` ### Export Functionality - **Complete Configuration**: All subject-group assignments - **Analysis Ready**: Formatted for re-import or sharing - **Documentation**: Serves as analysis record",
    "url": "/wiki/nifti-group-averaging/"
  },
  {
    "title": "Nilearn Visuals",
    "content": "The Nilearn Visuals extension creates publication-ready visualizations of temporal interference (TI) stimulation fields using the Nilearn neuroimaging library. This tool generates high-quality brain images with multiple anatomical views, atlas contours, and customizable thresholds for scientific publications and presentations. ## Key Features - **Group Averaging**: Automatically compute averages across multiple subjects/simulations - **Multiple View Types**: Sagittal, coronal, axial, and glass brain projections - **Atlas Integration**: Overlay anatomical atlas contours for anatomical reference - **Flexible Thresholding**: Support for both absolute values and percentile-based cutoffs - **High-Resolution Output**: Generate publication-quality PDF files ## User Interface The extension provides a comprehensive GUI for configuring visualization parameters: ### Subject-Simulation Selection Configure which subjects and simulations to include in the group average: - **Add Individual Pairs**: Manually select subject-simulation combinations - **Quick Add**: Batch-add the same simulation across multiple subjects ### Visualization Parameters #### Output Configuration - **Sub-directory**: Custom output folder within `derivatives/ti-toolbox/nilearn_visuals/` - **Atlas Selection**: Choose from Harvard-Oxford (subcortical/cortical), AAL, or Schaefer atlases #### Threshold Settings - **Cutoff Mode**: Absolute V/m values or percentile-based thresholds - **Minimum Cutoff**: Lower threshold for field visualization (default: 95th percentile or 0.3 V/m) - **Maximum Cutoff**: Upper threshold for field visualization (default: 99.9th percentile or 5.0 V/m) #### Region Selection - **All Regions**: Visualize fields across the entire brain - **Specific Regions**: Focus on individual atlas regions for targeted analysis ## Workflow Example ### Basic Group Visualization 1. **Launch Extension**: Settings  Extensions  \"Nilearn Visuals\" 2. **Configure Subjects**: Add subject-simulation pairs for averaging 3. **Set Parameters**: - Output directory: `hippocampus_stimulation` - Atlas: `harvard_oxford_sub` - Cutoff mode: Percentiles (95% - 99.9%) 4. **Generate Images**: Click \"Generate Images\" to process ### Output Structure Results are saved to `derivatives/ti-toolbox/nilearn_visuals/{sub-directory}/`: ``` hippocampus_stimulation/  group_averaged_5_subjects.nii.gz # Averaged NIfTI file  group_averaged_5_subjects_parameters.txt # Complete parameter log  group_averaged_5_subjects_multiple_views.pdf # Main visualization  group_averaged_5_subjects_glass_brain.pdf # Glass brain view ``` ## Technical Details ### Data Processing Pipeline 1. **Data Loading**: Load NIfTI files using pattern `grey_{simulation_name}_TI_MNI_MNI_TI_max.nii.gz` 2. **Group Averaging**: Compute mean across all subject-simulation pairs 3. **Threshold Application**: Apply min/max cutoffs to field data 4. **Atlas Overlay**: Add anatomical contours using selected atlas 5. **Visualization Generation**: Create multiple view PDFs using Nilearn ### Thresholding Strategies #### Percentile Mode - Automatically calculates thresholds based on max value of the field - Example: 95th-99.9th percentile captures the strongest 5% of field values - Pro Tip: Never set upper threshold to 100% of max value as this can be an outlier #### Absolute Mode - Fixed V/m thresholds for consistent visualization - Useful for comparing across different studies or protocols - Example: 0.3-5.0 V/m shows fields above physiological thresholds ### Atlas Options - **harvard_oxford_sub**: Harvard-Oxford subcortical atlas (9 regions) - **harvard_oxford**: Full Harvard-Oxford cortical + subcortical atlas (48+ regions) - **aal**: Automated Anatomical Labeling atlas (116 regions) - **schaefer_2018**: Schaefer cortical parcellation (100-1000 regions) ## Example Results ### Visualization Types The extension generates two main types of high-resolution visualizations: Glass brain projection showing TI field distribution with transparency for 3D visualization Multi-slice anatomical view showing TI field distribution across sagittal, coronal, and axial planes ### File Format Requirements - **NIfTI Files**: Must be in MNI space with `.nii.gz` extension - **File Pattern**: Default expects `grey_{simulation_name}_TI_MNI_MNI_TI_max.nii.gz` - **Data Type**: Floating-point values representing field intensity in V/m",
    "url": "/wiki/nilearn-visuals/"
  },
  {
    "title": "Pre-processing Pipeline",
    "content": "The TI-Toolbox pre-processing pipeline prepares anatomical MRI data for TI simulations by converting DICOM files to BIDS-compliant NIfTI format, performing FreeSurfer cortical reconstruction, and creating SimNIBS head models. This comprehensive pipeline ensures that all subsequent steps have access to high-quality, standardized neuroimaging data. ## Overview The pre-processing pipeline consists of three main stages: 1. **DICOM to NIfTI Conversion** - Convert raw DICOM files to BIDS-compliant NIfTI format 2. **FreeSurfer recon-all** - Cortical reconstruction and segmentation 3. **SimNIBS charm** - Head model creation for electromagnetic simulations ## Required Input Data Structure ### BIDS Format Requirements The toolbox expects data to be organized following the BIDS (Brain Imaging Data Structure) standard: ``` project_root/  sourcedata/  sub-{subject_id}/  T1w/   dicom/ # Raw T1w DICOM files   *.tgz # Compressed DICOM archives (optional)  T2w/  dicom/ # Raw T2w DICOM files  *.tgz # Compressed DICOM archives (optional) ``` ### Data Requirements | Requirement | Description | Status | |-------------|-------------|---------| | **T1-weighted MRI** | High-resolution anatomical image (typically MPRAGE) | **Required** | | **T2-weighted MRI** | High-resolution anatomical image (typically CUBE/SPACE) | **Recommended** | ### Supported Input Formats - **DICOM files** (`.dcm`, `.dicom`) - **Compressed DICOM archives** (`.tgz`) - **NIfTI files** (`.nii`, `.nii.gz`) - if already converted ## Processing Stages ### Stage 1: DICOM to NIfTI Conversion **Script:** `dicom2nifti.sh` **Purpose:** Convert raw DICOM files to BIDS-compliant NIfTI format #### Features - **Automatic T1w/T2w Detection**: Identifies scan types based on DICOM series descriptions - **Compressed Archive Support**: Handles `.tgz` compressed DICOM archives - **BIDS Compliance**: Generates proper BIDS naming conventions - **Metadata Preservation**: Maintains scan parameters in JSON sidecars #### Process Flow ```mermaid graph LR A[Raw DICOM Files] --> B[Extract Archives] B --> C[dcm2niix Conversion] C --> D[Rename Based on SeriesDescription] D --> E[BIDS-compliant NIfTI + JSON] ``` #### Usage ```bash # Convert DICOM files for a single subject ./dicom2nifti.sh /path/to/sub-101 # Quiet mode (no console output) ./dicom2nifti.sh /path/to/sub-101 --quiet ``` ### Stage 2: FreeSurfer recon-all **Script:** `recon-all.sh` **Purpose:** Cortical reconstruction, segmentation, and surface generation #### Features - **T1 + T2 Processing**: Utilizes both T1 and T2 images when available for improved pial surface reconstruction - **Parallel Processing**: Configurable for single-threaded or multi-threaded execution #### Usage ```bash # Single subject processing (1 core) ./recon-all.sh /path/to/sub-101 # With parallel processing (all available cores for this subject) ./recon-all.sh /path/to/sub-101 --parallel ``` **Note:** The `--parallel` flag in `recon-all.sh` enables FreeSurfer's internal parallelization (multiple cores for one subject). This is different from the `--parallel` flag in `structural.sh` which enables processing multiple subjects simultaneously. #### Generated Output Structure ``` derivatives/  freesurfer/  sub-101/  mri/ # Volumetric data  surf/ # Surface meshes  label/ # Anatomical labels  scripts/ ``` ### Stage 3: SimNIBS charm (Head Model Creation) **Script:** `charm.sh` **Purpose:** Create head models for TI simulation #### Features - **Input**: Supports T1-only or T1+T2 processing - **Sequential Processing**: Runs one subject at a time #### Usage ```bash # Create head model for single subject ./charm.sh /path/to/sub-101 ``` #### Generated Output Structure ``` derivatives/  SimNIBS/  sub-101/  m2m_101/ ``` ## Orchestration Script ### structural.sh - Pipeline Orchestrator **Purpose:** Coordinates all pre-processing stages with flexible execution options #### Command Line Interface ```bash # Sequential mode (default) - one subject at a time, all cores per subject ./structural.sh /path/to/sub-101 /path/to/sub-102 recon-all --convert-dicom --create-m2m # Parallel mode - multiple subjects simultaneously, 1 core per subject ./structural.sh /path/to/sub-101 /path/to/sub-102 recon-all --parallel --convert-dicom --create-m2m # Recon-all only ./structural.sh /path/to/sub-101 recon-all --recon-only # Subject ID format ./structural.sh --subjects 101,102,103 recon-all --parallel ``` #### Processing Options | Option | Description | Usage | |--------|-------------|-------| | `recon-all` | Run FreeSurfer reconstruction | Always required | | `--convert-dicom` | Include DICOM conversion stage | Optional | | `--create-m2m` | Include SimNIBS head model creation | Optional | | `--parallel` | Enable parallel processing mode (multiple subjects, 1 core each) | Optional | | `--recon-only` | Skip all non-recon steps | Optional | #### Processing Mode Selection **Default (Sequential Mode):** ```bash # Best for: Small datasets (1-3 subjects), maximum per-subject speed ./structural.sh /path/sub-101 /path/sub-102 recon-all --convert-dicom ``` **Parallel Mode:** ```bash # Best for: Large datasets (4+ subjects), maximum throughput ./structural.sh /path/sub-101 /path/sub-102 /path/sub-103 /path/sub-104 recon-all --parallel --convert-dicom ``` ## Parallelization Strategy ### Two-Mode Processing Architecture The pipeline implements a simple and efficient two-mode parallelization strategy: #### Processing Modes ```mermaid graph TD A[Processing Mode Selection] --> B{--parallel flag?} B -->|No| C[Sequential Mode] B -->|Yes| D[Parallel Mode] C --> E[One subject at a timeAll cores per subjectMaximum speed per subject] D --> F[Multiple subjects simultaneously1 core per subjectMaximum throughput] G[8 CPU cores example] --> H[Sequential: 1 subject  8 cores] G --> I[Parallel: 8 subjects  1 core each] ``` #### Mode Comparison | Mode | Command | Subjects Running | Cores per Subject | Best For | |------|---------|------------------|-------------------|----------| | **Sequential** (Default) | `./structural.sh sub-101 sub-102 recon-all` | 1 at a time | All available | Small datasets, fastest per-subject | | **Parallel** | `./structural.sh sub-101 sub-102 recon-all --parallel` | Multiple | 1 each | Large datasets, maximum throughput | #### SimNIBS Processing SimNIBS charm processing is **always sequential** regardless of mode: - One subject processed at a time to prevent PETSC memory conflicts - Full CPU cores available per subject - Memory safeguards to prevent segmentation faults ## CLI Execution Example ```bash # Stage 1: DICOM conversion only ./dicom2nifti.sh /mnt/study_data/sub-101 # Stage 2: FreeSurfer reconstruction only # Sequential mode (all cores for this subject) ./recon-all.sh /mnt/study_data/sub-101 --parallel # Parallel mode (1 core for this subject) ./recon-all.sh /mnt/study_data/sub-101 # Stage 3: SimNIBS head model only ./charm.sh /mnt/study_data/sub-101 ``` ## Output Directory Structure ### Complete Processing Output ``` project_root/  sourcedata/ # Original DICOM data   sub-101/   T1w/dicom/   T2w/dicom/  sub-101/ # BIDS data   anat/   anat-T1w_acq-MPRAGE.nii.gz   anat-T2w_acq-CUBE.nii.gz  derivatives/ # Processed outputs  freesurfer/ # FreeSurfer outputs   sub-101/   mri/   surf/   scripts/  SimNIBS/ # SimNIBS outputs  sub-101/  m2m_101/ ``` ## Logging and Monitoring ### Log File Organization ``` derivatives/ti-toolbox/logs/sub-{subject_id}/  dicom2nifti_{timestamp}.log # DICOM conversion logs  recon-all_{timestamp}.log # FreeSurfer processing logs  charm_{timestamp}.log # SimNIBS processing logs ``` ### Log Content Examples #### Successful Processing ``` [2025-06-25 13:45:23] [recon-all] [INFO] Starting FreeSurfer recon-all for subject: sub-101 [2025-06-25 13:45:24] [recon-all] [INFO] Found T1 image: /mnt/study/sub-101/anat/anat-T1w_acq-MPRAGE.nii.gz [2025-06-25 13:45:24] [recon-all] [INFO] Found T2 image: /mnt/study/sub-101/anat/anat-T2w_acq-CUBE.nii.gz [2025-06-25 13:45:24] [recon-all] [INFO] T2 image will be used for improved pial surface reconstruction [2025-06-25 15:23:45] [recon-all] [INFO] Verification results: Essential files found: 9/9 [2025-06-25 15:23:45] [recon-all] [INFO] FreeSurfer completion verification PASSED ``` #### Error Detection ``` [2025-06-25 14:15:32] [recon-all] [ERROR] Command failed with critical system error: recon-all -subject sub-103... [2025-06-25 14:15:32] [recon-all] [ERROR] System error details: Illegal instruction [2025-06-25 14:15:32] [recon-all] [ERROR] FreeSurfer recon-all verification failed for subject: sub-103 ``` ### Monitoring Progress Monitor processing progress in real-time: ```bash # Monitor all logs for a subject tail -f /mnt/project/derivatives/logs/sub-101/*.log # Monitor specific stage tail -f /mnt/project/derivatives/logs/sub-101/recon-all_*.log # Check processing status across subjects ls -la /mnt/project/derivatives/freesurfer/*/mri/aseg.mgz ``` ### Performance Optimization 1. **Parallel Processing**: Use `--parallel` flag for multiple subjects 2. **Memory Management**: Ensure adequate Docker memory allocation 3. **Disk I/O**: Use fast storage (SSD) for improved performance 4. **CPU Utilization**: Consider leaving a couple of cores free ## Integration with Analysis Pipeline The pre-processing pipeline generates all necessary inputs for downstream TI analysis: - **FreeSurfer surfaces**  `ex-search` electrode optimization - **SimNIBS head models**  `simulator` electromagnetic field computation - **BIDS anatomical data**  `analyzer` ROI analysis and visualization See the [Ex-Search](ex-search.md) and [Simulator](simulator.md) documentation for details on using pre-processed data in TI analysis workflows.",
    "url": "/wiki/pre-processing/"
  },
  {
    "title": "Pre-Processing Gallery",
    "content": "DICOM to NIfTI Conversion & FreeSurfer Segmentation DICOM files serve as the only require input data to start the pipeline. 3D volumetric niftii file is created using dcm2niix from DICOMs. Automatic co-registration of multiple EEG nets is part of the CHARM function Multiple cortical atlases are aligned to subject space &times; &#10094; &#10095; .gallery-section { margin: 2rem 0; padding: 1rem; background-color: #f8f9fa; } .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; margin-top: 1rem; } .gallery-item { background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; transition: transform 0.2s ease, box-shadow 0.2s ease; } .gallery-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); } /* Override wiki.css image styles with more specific selectors and !important */ .wiki-content .gallery-item img, .gallery-item img { width: 100% !important; max-width: 500px !important; max-height: 400px !important; height: auto !important; object-fit: contain !important; border-radius: 4px !important; margin-bottom: 0.5rem !important; margin-left: auto !important; margin-right: auto !important; margin-top: 0 !important; display: block !important; box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important; loading: lazy; } .gallery-item p { margin: 0; font-size: 0.9rem; color: #666; line-height: 1.4; } @media (max-width: 768px) { .gallery-grid { grid-template-columns: 1fr; gap: 1rem; } .gallery-section { margin: 1rem 0; padding: 0.5rem; } .wiki-content .gallery-item img, .gallery-item img { max-width: 100% !important; max-height: 300px !important; } } @media (max-width: 480px) { .wiki-content .gallery-item img, .gallery-item img { max-height: 250px !important; } }",
    "url": "/gallery/pre-processing/"
  },
  {
    "title": "Python Environment",
    "content": "The TI-Toolbox operates within a containerized environment that includes SimNIBS. The `simnibs_python` interpreter is SimNIBS's bundled Python environment that provides all libraries for TI-Toolbox operations. If you want to add a package for a new feature, follow the steps below. ### Environment Management | Task | Command | |------|---------| | Check location | `which simnibs_python` | | List installed packages | `simnibs_python -m pip list` | | Install package | `simnibs_python -m pip install ` | ### Key Points - **Containerized Setup**: The environment is defined in `container/blueprint/Dockerfile.simnibs`, which installs SimNIBS v4.5.0 and additional Python packages (meshio, nilearn, PyOpenGL-accelerate, trimesh, seaborn) required for TI-Toolbox functionality. - **Script executions**: All python scripts should be executed using the `simnibs_python script.py`.",
    "url": "/wiki/python_env/"
  },
  {
    "title": "Quick Notes",
    "content": "The Quick Notes extension provides a simple note-taking tool for documenting observations, decisions, and insights during sessions. Notes are automatically timestamped and persistently stored in the project directory. ## Key Features - **Automatic Timestamping**: Every note includes precise timestamp with timezone information - **Persistent Storage**: Notes saved to project directory following BIDS conventions - **Session Continuity**: Notes persist across TI-Toolbox restarts - **Copy to Clipboard**: Easy export of notes for reports or presentations - **Clean Formatting**: Structured display with separators and chronological ordering ### Note Format Each note follows a consistent structure: ``` [2024-11-01 14:30:45 EST] This is my observation about the hippocampal stimulation results. The field strength appears optimal at 2.3 V/m for this electrode configuration. ---------------------------------------------------------------------- ``` ## Usage Workflow ### Basic Note-Taking 1. **Launch Extension**: Settings  Extensions  \"Quick Notes\" 2. **Compose Note**: Type observations in the input area 3. **Add Note**: Click \"Add Note\" to timestamp and save 4. **Review History**: Scroll through previous notes in the display area ## Technical Details ### Storage Location Notes are saved following BIDS derivatives structure: ``` project_dir/  derivatives/  ti-toolbox/  notes.txt ``` This ensures notes are: - **Project-specific**: Associated with the correct dataset - **Backup-compatible**: Included in standard data backup procedures - **Collaboration-friendly**: Accessible to all researchers working on the project ### Timestamp Format Notes use ISO 8601 format with timezone information: ``` YYYY-MM-DD HH:MM:SS TZ ``` **Examples:** - `2024-11-01 14:30:45 EST` (Eastern Standard Time) - `2024-11-01 19:30:45 UTC` (Coordinated Universal Time) - `2024-11-01 11:30:45 PST` (Pacific Standard Time) ### Timezone Handling The extension automatically detects the host system's timezone: ```python # Automatic timezone detection tz_name = os.environ.get('TZ', 'UTC') # Falls back gracefully for systems without timezone info ``` ## Troubleshooting ### Common Issues **\"No project directory detected\"** - Ensure TI-Toolbox is properly initialized with a project directory - Check that the project follows BIDS structure - Verify write permissions to the derivatives directory **Timezone display issues** - Check system timezone settings - Extension falls back to UTC if timezone detection fails - Notes remain functional regardless of timezone display **File access errors** - Verify write permissions to project directory - Check for file locking by other applications - Ensure sufficient disk space for notes file ### Data Recovery **Notes File Location:** - Primary: `project/derivatives/ti-toolbox/notes.txt` - Backup: Check TI-Toolbox log files for any error messages - Recovery: Notes are plain text and can be edited manually if needed",
    "url": "/wiki/quick-notes/"
  },
  {
    "title": "Latest Release",
    "content": "### v2.2.2 (Latest Release) **Release Date**: December 25, 2025 #### Additions - - **Simulator Refactoring**: Complete rewrite from bash to Python with modular architecture including progress callbacks, better error handling, and improved logging. - - **Enhanced Cluster Permutation Testing**: New ACES-like correlation investigation, support for continuous variables, enhanced reporting, and improved GUI integration. - - **Comprehensive Testing Infrastructure**: new test files with code coverage integration, headless operation support, and improved CI/CD pipeline. - - **Improved 3D Visualization**: Enhanced visual exporter with automatic electrode placement, metadata extraction, GLB format export, and Docker-based Blender integration. - - **Pythonic CLI Migration**: New Click-based command-line interfaces for simulator and cluster permutation tools with better argument validation. - - **GUI Enhancements**: Improved threading across all tabs with real-time progress updates, better error handling, and enhanced responsiveness. #### Fixes - - **Various Bug Fixes**: Fixed silent timeout issues in CI, corrected coverage integration, improved error handling in all major modules, better cleanup of temporary files, and enhanced logging. - - **Windows Electron**: A more robust executable delivery on Windows. #### Download Links **Desktop App (latest):** [macOS Intel](https://github.com/idossha/TI-toolbox/releases/latest/download/TI-Toolbox-x64.dmg) 路 [macOS Apple Silicon](https://github.com/idossha/TI-toolbox/releases/latest/download/TI-Toolbox-arm64.dmg) 路 [Windows](https://github.com/idossha/TI-toolbox/releases/latest/download/TI-Toolbox-Setup.exe) 路 [Linux AppImage](https://github.com/idossha/TI-toolbox/releases/latest/download/TI-Toolbox.AppImage) 路 [Linux deb](https://github.com/idossha/TI-toolbox/releases/latest/download/ti-toolbox.deb) **Other:** - Docker Image: `docker pull idossha/simnibs:latest` - Source Code: [GitHub Repository](https://github.com/idossha/TI-Toolbox) For installation instructions, see the [Installation Guide]({{ site.baseurl }}/installation/). #### Backward compatibility change to be aware: - **Electode Mapping**: We changed the mapping functionality from the **flex-seach** to the **simulator**. This to provide a more flexible and dynamic framework. Now, the flex-search outputs the: `electrode_positions.json` file and the mapping functionality happeneds on the simulator side using the new method `ti-toolbox/tools/map_electrodes.py`. Thus, one can use a single flex-search to conveniently map to multiple nets. #### Additions - **Desktop App**: Recognizing the importance of Desktop delivery, we redesign our executables with Electron. For more info please see `package`. - **Benchmarks**: Added benchmarking tool with sensible defaults that users can run on their systems - **AMV**: Improved automatic montage visualization that now supports all available nets with a higher resolution image. - **Flex-search**: Added more control over electrode geometry now supporting rectengular and width control. - **Flex-search**: Exapnded hyper-parameter control. tolerance and mutation rate. - **Ex-search**: Enhanced the tool with current ratio optimization, enabling more efficient exploration of electrode current distributions. The exhaustive search now evaluates possible electrode montages and current distributions according to the formula: $N_\\text{total} = N_\\text{elec}^4 \\cdot N_\\text{current}$, where $N_\\text{current} = \\{(I_1,I_2) \\mid I_1+I_2=I_\\text{total} \\wedge I_\\text{step} \\leq I_1,I_2 \\leq I_\\text{limit}\\}$. #### Fixes - **Various Bug Fixes**: protection overwrites, documentation, output formatting, UI improvements, parallel processing, electrode management #### Download Links **Desktop App (latest):** [macOS Intel](https://github.com/idossha/TI-toolbox/releases/latest/download/TI-Toolbox-x64.dmg) 路 [macOS Apple Silicon](https://github.com/idossha/TI-toolbox/releases/latest/download/TI-Toolbox-arm64.dmg) 路 [Windows](https://github.com/idossha/TI-toolbox/releases/latest/download/TI-Toolbox-Setup.exe) 路 [Linux AppImage](https://github.com/idossha/TI-toolbox/releases/latest/download/TI-Toolbox.AppImage) 路 [Linux deb](https://github.com/idossha/TI-toolbox/releases/latest/download/ti-toolbox.deb) **Other:** - Docker Image: `docker pull idossha/simnibs:latest` - Source Code: [GitHub Repository](https://github.com/idossha/TI-Toolbox) For installation instructions, see the [Installation Guide]({{ site.baseurl }}/installation/). --- ## Getting Help If you encounter issues with any release: 1. Check the [Installation Guide]({{ site.baseurl }}/installation/) for setup instructions 2. Review the [Troubleshooting]({{ site.baseurl }}/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/"
  },
  {
    "title": "TI-Toolbox Reports",
    "content": "The TI-Toolbox generates comprehensive HTML reports that provide detailed documentation of preprocessing and simulation workflows. These professional reports ensure reproducibility, facilitate quality control, and provide publication-ready methodology descriptions. ## Overview The toolbox produces two types of reports: - **Preprocessing Reports**: Document anatomical data processing pipeline for each subject - **Simulation Reports**: Detail transcranial stimulation simulation parameters and results - **Interactive Format**: HTML reports with collapsible sections and modern styling - **Publication Ready**: Include boilerplate methodology text for scientific papers ## Report Features ### Professional Documentation - **Interactive HTML Interface**: Modern, responsive design with collapsible sections - **Comprehensive Tracking**: Complete workflow documentation from input to output - **Error Management**: Detailed error and warning logs with timestamps - **Software Versioning**: Complete tool version tracking for reproducibility ### Quality Control - **Status Indicators**: Visual confirmation of processing step completion - **File Validation**: Automatic counting and listing of input/output files - **Parameter Documentation**: Complete record of processing parameters - **Visual Confirmation**: Brain visualizations and NIfTI previews ## Example: Simulation Report Below is an embedded example of a complete simulation report generated by the TI-Toolbox: *Interactive simulation report showing complete workflow documentation, parameters, and results* ## Preprocessing Reports ### Report Structure | Section | Content | Purpose | |---------|---------|---------| | **Header** | Subject ID, timestamp, project directory | Quick identification | | **Summary** | Processing status, file counts, error/warning counts | Overview dashboard | | **Input Data** | T1/T2 images, DICOM files with counts | Data validation | | **Processing Steps** | DICOM conversion, m2m creation, atlas segmentation | Workflow tracking | | **Output Data** | NIfTI files, m2m files, atlas files | Result verification | | **Software Info** | SimNIBS, dcm2niix, tool versions | Reproducibility | | **Methods** | Publication-ready methodology text | Scientific documentation | | **Errors/Warnings** | Timestamped messages | Quality control | ### Key Information Tracked **Subject Information:** - Subject ID and BIDS compliance - Project directory structure - Input data inventory (T1, T2, DICOM files) **Processing Pipeline:** - DICOM to NIfTI conversion status - SimNIBS m2m head model creation - Atlas segmentation and registration - Parameter documentation for each step **Quality Assurance:** - File count verification - Processing step completion status - Error and warning documentation - Software version tracking ## Simulation Reports ### Report Structure | Section | Content | Purpose | |---------|---------|---------| | **Header** | Session ID, timestamp, project info | Session identification | | **Summary** | Subject overview, montage info, processing status | Executive summary | | **Parameters** | Conductivity, simulation mode, EEG configuration | Simulation setup | | **Electrodes** | Shape, dimensions, thickness, configuration | Hardware specification | | **Subjects** | Subject IDs, m2m paths, processing status | Multi-subject tracking | | **Montages** | Electrode pairs, montage types, configurations | Stimulation protocols | | **Results** | Output files, duration, processing status | Outcome documentation | | **Visualizations** | Brain renders, NIfTI previews | Visual verification | | **Methods** | Publication methodology text | Scientific documentation | ### Key Information Tracked **Simulation Configuration:** - Conductivity settings and tissue properties - Simulation mode (unipolar/multipolar) - EEG net configuration and electrode positions - Current intensities and stimulation parameters **Hardware Specifications:** - Electrode shape, dimensions, and thickness - Montage configurations and electrode pairs - Stimulation protocols and current flow patterns **Results Documentation:** - Processing duration and computational metrics - Output file generation and validation - Visual confirmation through brain renderings - Error tracking and quality assurance ## Report Locations ### File Organization ``` derivatives/reports/  preprocessing/   sub-001_preprocessing_report.html   sub-002_preprocessing_report.html   ...  simulation/  simulation_report_20250610_063527.html  simulation_report_20250611_142033.html  ... ``` ### Naming Convention - **Preprocessing**: `sub-{ID}_preprocessing_report.html` - **Simulation**: `simulation_report_{YYYYMMDD}_{HHMMSS}.html` ## Viewing and Sharing ### Browser Compatibility - **Modern Browsers**: Chrome, Firefox, Safari, Edge - **Responsive Design**: Adapts to different screen sizes - **No Dependencies**: Self-contained HTML files ### Sharing Reports - **Self-Contained**: All styling and scripts embedded - **Portable**: Can be shared via email or cloud storage - **Archive Safe**: HTML format ensures long-term accessibility ## Publication Integration ### Methodology Text Both report types include publication-ready methodology sections that can be directly incorporated into scientific papers: - **Complete Parameter Documentation**: All processing parameters documented - **Software Version Tracking**: Ensures reproducible methodology descriptions - **Standard Terminology**: Uses established neuroimaging terminology - **Citation Ready**: Includes appropriate tool and method citations ### Quality Assurance - **Peer Review Ready**: Comprehensive documentation supports manuscript review - **Reproducibility**: Complete parameter and version tracking - **Transparency**: Open documentation of all processing steps --- *Last Updated: January 2025* *Compatible with: TI-Toolbox v4.0+, Modern Web Browsers*",
    "url": "/wiki/reports/"
  },
  {
    "title": "Search Results",
    "content": "Search Results Search No results found for your search query. Try different keywords or check your spelling.",
    "url": "/search/"
  },
  {
    "title": "Simulations Gallery",
    "content": "Temporal Interference Field Simulation MRI-based region of interest analysis with temporal interference field distribution. Region of interest analysis showing precise targeting of brain structures. Brain atlas visualization with anatomical structures and regions clearly defined. Atlas overlay with electric field distribution for anatomical reference and targeting. &times; &#10094; &#10095; .gallery-section { margin: 2rem 0; padding: 1rem; background-color: #f8f9fa; } .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; margin-top: 1rem; } .gallery-item { background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; transition: transform 0.2s ease, box-shadow 0.2s ease; } .gallery-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); } /* Override wiki.css image styles with more specific selectors and !important */ .wiki-content .gallery-item img, .gallery-item img { width: 100% !important; max-width: 500px !important; max-height: 400px !important; height: auto !important; object-fit: contain !important; border-radius: 4px !important; margin-bottom: 0.5rem !important; margin-left: auto !important; margin-right: auto !important; margin-top: 0 !important; display: block !important; box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important; loading: lazy; } .gallery-item p { margin: 0; font-size: 0.9rem; color: #666; line-height: 1.4; } @media (max-width: 768px) { .gallery-grid { grid-template-columns: 1fr; gap: 1rem; } .gallery-section { margin: 1rem 0; padding: 0.5rem; } .wiki-content .gallery-item img, .gallery-item img { max-width: 100% !important; max-height: 300px !important; } } @media (max-width: 480px) { .wiki-content .gallery-item img, .gallery-item img { max-height: 250px !important; } }",
    "url": "/gallery/simulations/"
  },
  {
    "title": "Simulator",
    "content": "The Simulator module provides temporal interference (TI) simulation capabilities within the TI-Toolbox GUI, supporting multiple montage sources, electrode configurations, and simulation parameters. ## User Interface The simulator GUI provides intuitive controls for all simulation parameters: ### Main Controls - **Subject Selection**: Choose from available pre-processed subjects - **Montage Source**: Radio buttons for montage list, flex mode, and free-hand - **Simulation Mode**: Unipolar/multipolar selection with current inputs - **EEG Net**: Dropdown selection of available electrode configurations ### Advanced Options - **Conductivity Model**: Isotropic/anisotropic tissue modeling - **Current Configuration**: Individual electrode current settings - **Batch Processing**: Multiple subject simulation queues ### Output Management - **Real-time Logging**: Simulation progress and status updates - **Result Visualization**: Automatic generation of field maps and statistics - **Data Export**: NIfTI files, electrode positions, and analysis reports --- ## Montage Sources The simulator supports three primary montage source types: ### 1. Montage List Pre-defined electrode configurations organized by EEG net and stimulation mode: - **Unipolar Montages**: The traditiona two pairs electrode montage - **Multipolar Montages**: Multiple (currently only supporting four) pairs for higher focality - **EEG Net Compatibility**: Automatically filtered based on selected electrode configuration - **Management**: Add, remove, and refresh montage collections ### 2. Flex Mode Automatic integration with the flex-search optimizer. - **Optimize**: Start by running the optimizer based on your needs - **Simulate**: Move to the simulator and use the automatic montage available from the flex-search ### 3. Free-Hand Mode that allows exploration of untraditional montages - **Flexible Positioning**: Manual electrode placement for specialized protocols - **Extension**: Open up the `electrode placement` extension to freely place electrodes on subjects --- ## Simulation Modes Left column unipolar (two channels) right column multipolar (four channels). Panels A,D: target and electrode montage. Panels B,E: high frequency fields. Panels C,F: modulation fields. ### Unipolar Mode - **Configuration**: Single active electrode with dedicated return path - **Current Settings**: Two current inputs (active and return electrodes) - **Applications**: Focal stimulation with clear current flow direction - **Montage Compatibility**: Works with unipolar montage collections ### Multipolar Mode - **Configuration**: Multiple active electrodes (up to 4 channels) - **Current Settings**: Four current inputs for complex stimulation patterns - **Applications**: Distributed stimulation, field steering, and complex targeting - **Montage Compatibility**: Works with multipolar montage collections --- ## Available EEG Nets The simulator automatically detects and supports various electrode configurations: ### Standard EEG Nets - **10-10 System**: High-density electrode placement (64+ electrodes) - **10-20 System**: Standard clinical electrode placement (32 electrodes) - **GSN-HydroCel-256**: High-density research net (256 electrodes) - **GSN-HydroCel-185**: Research-grade net (185 electrodes) ### Specialized Nets - **EGI Systems**: Multiple EGI electrode configurations - **EasyCap**: TMS-compatible electrode layouts - **Custom Nets**: User-defined electrode positions via CSV files ### Net Detection - **Automatic Scanning**: Searches `eeg_positions/` directories for available nets - **Dynamic Updates**: Montage lists refresh based on selected EEG net - **Compatibility Filtering**: Only compatible montages shown for selected net --- ## Anisotropy The simulator supports different tissue conductivity models: ### Isotropic Model - **Description**: Uniform conductivity in all directions - **Applications**: Simplified modeling, faster computation - **Limitations**: May not accurately represent white matter anisotropy ### Anisotropic Model - **Description**: Direction-dependent conductivity based on DTI data - **Requirements**: Diffusion tensor imaging (DTI) scans - **Applications**: More realistic modeling of white matter tracts - **Processing**: Accounts for fiber orientation in field calculations --- ## Coordinate Spaces ### Subject Space - **Definition**: Coordinates relative to individual subject anatomy - **Origin**: Centered on subject's brain anatomy - **Applications**: Subject-specific targeting and analysis - **File Format**: Native FreeSurfer subject space coordinates ### MNI Space - **Definition**: Standardized coordinate system (MNI152 template) - **Origin**: Based on Montreal Neurological Institute template - **Applications**: Cross-subject comparisons and group analysis - **Transformations**: Automatic conversion between subject and MNI space ### Space Transformations - **Automatic Conversion**: Built-in coordinate transformation utilities - **ROI Mapping**: Support for both subject and MNI coordinate inputs - **Visualization**: Compatible with both coordinate systems for analysis",
    "url": "/wiki/simulator/"
  },
  {
    "title": "Testing Pipeline",
    "content": "## Overview The TI-Toolbox uses a multi-layered testing approach that combines unit tests, integration tests, and automated CI/CD through CircleCI. The testing pipeline ensures code quality, functionality, and reliability across all components of the toolbox. Complete TI-Toolbox Tech-stack TI-Toolbox CI/CD Pipeline &#10094; &#10095; ## What is CircleCI? CircleCI is a continuous integration and continuous deployment (CI/CD) platform that automatically builds, tests, and deploys code when changes are pushed to the repository. For the TI-Toolbox, CircleCI: - **Automatically triggers** on every pull request to the main branch - **Uses static test image** - `idossha/ti-toolbox-test:latest` - **Runs ALL tests** - both unit and integration tests - **Provides detailed reports** on test results and artifacts - **Ensures perfect parity** between local and CI testing environments ## Pipeline Configuration The testing pipeline is configured in `.circleci/config.yml` and consists of: ### Executors - **vm-docker**: Uses Ubuntu 22.04 with Docker layer caching disabled for consistent builds ### Workflow Triggers - **Pull Requests**: Tests automatically run on all branches when a PR is created/updated - **Direct Commits**: Tests do NOT run on direct commits to `main` or `master` branches - This approach encourages proper PR workflow and saves CI resources ### Key Components #### 1. TI-Toolbox Test Image The pipeline uses a static test image designed for CI/CD: - **Image**: `idossha/ti-toolbox-test:latest` - **Contains**: - Ubuntu 22.04 - SimNIBS 4.5 (electromagnetic field simulations) - Python 3.11 with all scientific packages - pytest and BATS testing frameworks - All system utilities (curl, wget, jq, unzip, dos2unix, etc.) - **No TI-Toolbox code** (mounted from PR at runtime) **Benefits:** - Static image - doesn't change unless dependencies update - PR code is mounted at runtime for testing - TI-Toolbox extensions copied from PR code - Same image used locally and in CI #### 2. Test Execution Single unified test runner: **Entry Point**: `./tests/run_tests.sh` - Runs inside SimNIBS container - Tests PR code (mounted into container) - Executes all tests: unit + integration - Used by both local testing and CI **Tests Run**: - **Unit Tests** (~2 min): 164 tests (analyzer, simulator, flex-search) - **Integration Tests** (~15-20 min): Full simulations, analysis pipelines, validation --- ## Local Testing Developers should run the complete test suite locally with the exact same environment as CI. **锔 Important:** Always use `./tests/test.sh` from your host machine. Do NOT run individual integration test scripts (`test_simulator_runner.sh`, `test_analyzer_runner.sh`) directly - they require the Docker container environment and will fail on your host. ### Quick Start ```bash # Run all tests (unit + integration) - RECOMMENDED before committing ./tests/test.sh # Run only unit tests (fast ~2 min) - for quick validation during development ./tests/test.sh --unit-only # Run with verbose output - helpful for debugging test failures ./tests/test.sh --verbose # Run only integration tests - if you've already verified unit tests ./tests/test.sh --integration-only ``` ### Available Options - `-h, --help`: Show help message - `-u, --unit-only`: Run only unit tests (fast) - `-i, --integration-only`: Run only integration tests - `-v, --verbose`: Show detailed test output - `-s, --skip-setup`: Skip test project setup (reuse existing data) - `-n, --no-cleanup`: Keep test directories after completion ### Environment Variables - `TEST_IMAGE`: Override test image version (default: `idossha/ti-toolbox-test:latest`) ### Benefits of Local Testing -  **Perfect parity**: Same Docker image as CI (`idossha/ti-toolbox-test:latest`) -  **Complete testing**: All tests run (unit + integration) -  **Fast feedback**: Test locally before submitting a PR -  **Predictable**: If it passes locally, it passes in CI -  **Tests your code**: Your local changes are mounted into container and tested --- ## Test Structure ### Unit Tests Location: `tests/` The unit tests are organized by component: #### Analyzer Tests - `test_analyzer.py`: Core analyzer functionality - `test_mesh_analyzer.py`: Mesh-based analysis methods - `test_voxel_analyzer.py`: Voxel-based analysis methods - `test_group_analyzer.py`: Group-level analysis capabilities #### Simulator Tests - `test_ti_simulator.py`: unipolar TI simulation - `test_mti_simulator.py`: multipolar TI simulation #### Flex-Search Tests - `test_flex_search.py`: Flex-search optimization approach ### Integration Tests #### Test Setup (`tests/setup_test_projectdir.sh`) Creates a complete BIDS-compliant test project structure: - Downloads ErnieExtended dataset from SimNIBS - Sets up proper directory structure (`sourcedata/`, `derivatives/`, `code/`) - Creates montage configurations for multiple EEG nets - Downloads test simulation data - Configures proper permissions #### Output Validation (`tests/test_*.bats`) - `test_simulator_outputs.bats`: Validates simulation outputs - `test_analyzer_outputs.bats`: Validates analysis results --- ## Test Execution Flow ### Local Testing (Initial Test) ```bash # From your host machine (TI-Toolbox root directory) ./tests/test.sh # What happens: # 1. Script checks Docker is running # 2. Pulls idossha/ti-toolbox-test:latest (if needed) # 3. Mounts your local code into container at /ti-toolbox # 4. Creates test directories (/tmp/test_projectdir on host) # 5. Runs: ./tests/run_tests.sh inside container # - Copies TI-Toolbox extensions (ElectrodeCaps, tes_flex) to SimNIBS # - Runs unit tests with pytest # - Sets up test project with ErnieExtended data # - Runs integration tests (simulator, analyzer) # - Validates outputs with BATS # 6. Cleans up test directories # 7. Displays results ``` ### CI/CD Testing (CircleCI) ```bash # CircleCI does: # 1. Checkout PR code # 2. Pull idossha/ti-toolbox-test:latest # 3. Mount PR code into container at /ti-toolbox # 4. Script copies extensions (ElectrodeCaps, tes_flex) to SimNIBS # 5. Run: ./tests/run_tests.sh --verbose # 6. Store artifacts and report results ``` ---",
    "url": "/wiki/testing-pipeline/"
  },
  {
    "title": "Tissue Analyzer",
    "content": "The Tissue Analyzer extension provides volumetric assessment f different tissue types from segmented NIfTI data. This tool supports analysis of cerebrospinal fluid (CSF), bone, and skin tissues with automated volume and thickness calculations. ## Key Features - **Multi-Tissue Support**: Analyze CSF, bone, and skin tissues. - **Volume Calculations**: Automatic volume measurements based on labeled voxel data in subject space - **3D Thickness Analysis**: Distance transform-based thickness calculations with statistical summaries (experimental) - **Publication-Quality Visualizations**: High-resolution figures for axial, coronal, and sagittal views ## Analysis Pipeline ### 1. Tissue Identification - Load segmented NIfTI data from SimNIBS derivatives - Extract tissue masks using configured label numbers - Load label names from labeling_LUT.txt for human-readable output ### 2. Spatial Filtering - Identify brain reference regions (cortex and brainstem) - Apply 3D bounding box with configurable padding - Filter out lower anatomy using Z-coordinate thresholds - Focus analysis on relevant anatomical regions ### 3. Analysis - Calculate total tissue volume / thickness (experimental) - Account for voxel dimensions from NIfTI header - Provide voxel count statistics ## Calculation Methodology **Volume Calculation Methodology** Volume is calculated by multiplying the number of tissue voxels by the volume of each voxel: ``` Volume (mm鲁) = Number of tissue voxels  Voxel volume ``` Where: - **Number of tissue voxels**: Count of all voxels in the filtered tissue mask - **Voxel volume**: Product of voxel dimensions from the NIfTI header (`voxel_dim_x  voxel_dim_y  voxel_dim_z`) The voxel dimensions are extracted from the NIfTI header using `header.get_zooms()[:3]`, which provides the spatial resolution in millimeters for each dimension. This ensures accurate volume measurements regardless of the scan resolution. **Thickness Calculation Methodology** Thickness is calculated using a 3D Euclidean distance transform: ``` 1. Distance transform: Calculate distance from each tissue voxel to nearest boundary (background) 2. Thickness = Distance  2 ``` The algorithm uses scipy's `distance_transform_edt()` with voxel spacing sampling to account for anisotropic voxel dimensions. For each voxel within the tissue mask, the distance to the nearest boundary is computed. The thickness at each point is then defined as twice this distance, representing the full thickness of the tissue structure at that location. ### 4. Visualization and Reporting - Generate publication-quality figures - Create comprehensive analysis reports - Export results in multiple formats (PNG, PDF, text) ## Output Files ### Analysis Results ``` output_directory/  csf_analysis_summary.txt # Comprehensive analysis report  csf_thickness_analysis.png # Thickness visualization (PNG)  csf_thickness_analysis.pdf # Thickness visualization (PDF)  csf_extraction_methodology.png # Methodology illustration (PNG)  csf_extraction_methodology.pdf # Methodology illustration (PDF)  csf_combined_publication_figure.png # Combined analysis figure (PNG)  csf_combined_publication_figure.pdf # Combined analysis figure (PDF) ``` ## Data Requirements ### Input NIfTI Files - **Format**: NIfTI (.nii or .nii.gz) - **Segmentation**: Tissue labels from SimNIBS segmentation - **File**: labeling_LUT.txt (optional but recommended) - **Location**: Same directory as NIfTI, or parent directories ### Directory Structure ``` derivatives/  SimNIBS/  sub-XX/  m2m_sub-XX/  segmentation/   segmented.nii.gz # Input segmentation   labeling_LUT.txt # Label mapping (optional)  ... ``` ## Usage Workflow ### Command Line Usage ```bash # Basic CSF analysis python tissue_analyzer.py /path/to/segmented.nii.gz -t csf # Bone analysis with custom output directory python tissue_analyzer.py /path/to/segmented.nii.gz -t bone -o bone_results # Skin analysis with custom labels python tissue_analyzer.py /path/to/segmented.nii.gz -t skin -l 511 512 ``` ## Configuration Options ### Tissue-Specific Parameters ```python TISSUE_CONFIGS = { 'csf': { 'name': 'CSF', 'labels': [4, 5, 14, 15, 43, 44, 72, 24, 520], 'padding': 40, # voxels 'color_scheme': 'Blues', 'tissue_color': [0, 0, 1], 'brain_labels': [3, 42, 16] }, # ... additional tissue configurations } ``` ### Custom Label Names ```python # Override or add label names manually custom_labels = { 4: \"Left-Lateral-Ventricle\", 5: \"Left-Inf-Lat-Vent\", 511: \"Skin\" } analyzer.set_label_names(custom_labels) ``` ## Integration Notes ### TI-Toolbox Structure - **Output Organization**: Results organized under `derivatives/ti-toolbox/{tissue}_analysis/` - **Logging Integration**: Compatible with shared TI-toolbox logging utilities",
    "url": "/wiki/tissue-analyzer/"
  },
  {
    "title": "Troubleshooting",
    "content": "--- ## Docker Issues ### Docker not running **Symptoms:** \"Docker daemon not running\" or \"Cannot connect to Docker\" **Solution:** - **Windows/macOS**: Start Docker Desktop and wait for green status - **Linux**: ```bash sudo systemctl start docker sudo systemctl enable docker ``` ### Insufficient resources **Symptoms:** Slow performance, out of memory errors, failed simulations **Solution:** 1. Open Docker Desktop settings -> Go to Resources 2. Allocate: **Memory**: 32GB minimum 3. Apply and restart Docker ### Docker images not downloading **Symptoms:** Stuck at \"Pulling image\" or network timeouts **Solution:** 1. Check internet connection 2. Restart Docker Desktop 3. Try manual pull: ```bash docker pull idossha/simnibs:{version} ``` --- ## GUI Display Issues ### No GUI appears (Linux) **Solution:** ```bash # Allow Docker to access X11 xhost +local:docker # Check DISPLAY variable echo $DISPLAY # If empty, set manually export DISPLAY=:0 ``` ### No GUI appears (macOS) **Solution:** 1. Ensure [XQuartz 2.7.7] is installed (not newer versions) 2. Log out and back in after XQuartz installation 3. Launch XQuartz from Applications > Utilities 4. Check XQuartz preferences: Allow connections from network clients If still running into issues, download the **[config_sys.sh](https://github.com/idossha/TI-toolbox/blob/main/dev/bash_dev/config_sys.sh)** place it next to your loader.sh, and run it: ```bash bash config_sys.sh ``` ### No GUI appears (Windows) **Solution:** 1. Ensure VcXsrv is running (check system tray) 2. Verify VcXsrv configuration: - Multiple windows - Start no client - **\"Disable access control\" MUST be checked** 3. Restart VcXsrv if needed 4. Check Windows Firewall isn't blocking VcXsrv --- ## Getting Help ### Information to Include When reporting issues, include: 1. **System Information:** - OS version - Docker version - Available RAM/storage - X server version (XQuartz/VcXsrv) 2. **Error Details:** - Exact error messages - Steps to reproduce - When the error occurs - Screenshot if applicable 3. **Log Files:** - Docker logs: `docker logs [container_name]` - Application logs from output directory - System logs if relevant ### Where to Get Help 1. **[GitHub Issues](https://github.com/idossha/TI-Toolbox/issues)** - Search existing issues first 2. **[GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)** - Community support 3. **Documentation** - Check other installation guides for platform-specific help ### Diagnostic Commands Run these commands to gather system information: ```bash # System information uname -a docker --version docker info # Docker status docker ps docker images # Display information echo $DISPLAY xhost # Linux/macOS only # Resource usage free -h # Linux top # All platforms ```",
    "url": "/installation/troubleshooting/"
  },
  {
    "title": "",
    "content": "# Release v2.0.0 **Release Date**: May 28, 2025 #### Major Changes - Complete rewrite of the Temporal Interference Toolbox with major enhancements: Cross-platform support for Windows, macOS, and Linux - Docker-based containerization for consistent environment and reproducibility - Dual interface with both GUI and CLI support, enabling local and remote server usage - Key functionalities include DICOM to NIfTI conversion, FreeSurfer segmentation, SimNIBS head modeling, flexible and exhaustive electrode optimization algorithms, FEM-based temporal interference field calculations, and comprehensive analysis tools with atlas-based ROI evaluation #### Installation - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.0/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.0/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.0/TemporalInterferenceToolbox-Linux-x86_64.AppImage) For installation instructions, see the [Installation Guide]({{ site.baseurl }}/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({{ site.baseurl }}/installation/) for setup instructions 2. Review the [Troubleshooting]({{ site.baseurl }}/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.0.0/"
  },
  {
    "title": "",
    "content": "# Release v2.0.1 **Release Date**: June 11, 2025 #### Additions - new logger and report generators under 'projectDIR/derivatives/' - sub-cortical atlas based targeting for flex-search (example: thalamus targeting) #### Fixes - 2 decimal spherical ROIs - 'TI.py' overwrite protection removed - intenral 185 EGI net (removed 2 missed electrodes) - added imagemagick for montage visualizer #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.1/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.1/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.1/TemporalInterferenceToolbox-Linux-x86_64.AppImage) For installation instructions, see the [Installation Guide]({{ site.baseurl }}/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({{ site.baseurl }}/installation/) for setup instructions 2. Review the [Troubleshooting]({{ site.baseurl }}/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.0.1/"
  },
  {
    "title": "",
    "content": "# Release v2.0.2 **Release Date**: June 19, 2025 #### Additions - Enhanced X11 support for Windows with automatic host IP detection and VcXsrv/Xming configuration guidance - Created `windows_x11_setup.sh` helper script for simplified Windows X server setup - Added comprehensive Windows BIDS path guide (`WINDOWS_BIDS_PATH_GUIDE.md`) with troubleshooting tips - Improved cross-platform X11 configuration with better error handling and user guidance - Added OpenGL software rendering flags for better GUI compatibility across all platforms #### Fixes - Fixed volume mounting in docker-compose.yml - all required volumes now properly mounted to simnibs container - Fixed Windows path handling - automatic conversion of backslashes to forward slashes for Docker compatibility - Fixed paths with spaces on Windows - automatic quoting of paths containing spaces - Fixed X11 socket mounting for macOS XQuartz and Linux compatibility - Fixed DISPLAY environment variable configuration for Windows, macOS, and Linux - Fixed MATLAB Runtime library paths in container environment - Updated XQuartz version warning to reference memory about v2.7.7 compatibility requirement #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.2/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.2/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.2/TemporalInterferenceToolbox-Linux-x86_64.AppImage) For installation instructions, see the [Installation Guide]({{ site.baseurl }}/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({{ site.baseurl }}/installation/) for setup instructions 2. Review the [Troubleshooting]({{ site.baseurl }}/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.0.2/"
  },
  {
    "title": "",
    "content": "# Release v2.0.3 **Release Date**: June 20, 2025 #### Additions - Modified tes_flex_optimization.py to include eeg_net field in the .json - toggle between \"Montage Simulation\" (traditional) and \"Flex-Search Simulation\" with automatic discovery of optimization results and electrode type selection (mapped/optimized/both) - Modified TI.py and pipeline scripts to handle direct XYZ electrode coordinates instead of just electrode names, enabling optimized electrode positioning from flex-search results #### Fixes - N/A #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.3/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.3/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.3/TemporalInterferenceToolbox-Linux-x86_64.AppImage) For installation instructions, see the [Installation Guide]({{ site.baseurl }}/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({{ site.baseurl }}/installation/) for setup instructions 2. Review the [Troubleshooting]({{ site.baseurl }}/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.0.3/"
  },
  {
    "title": "",
    "content": "# Release v2.0.4 **Release Date**: June 26, 2025 #### Additions - flex-search -> simulator integration. Simulator now recognizes previous flex-searches and allows for simulation of both optimized and mapped electrodes. - system monitor -> added a GUI tab that allows users monitor the activity of processes hapenning within the toolbox #### Fixes - pre-process -> added missing shell for recon-all step - pre-process -> fixed parallalization problem - ex-search redesign -> now is not dependent on MATLAB Runtime, but is fully Python implemented - ex-search -> users can now creat multiple leadfields for the same subject - flex-search -> post processing method for TI envelope direction is implemented #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.4/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.4/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.4/TemporalInterferenceToolbox-Linux-x86_64.AppImage) For installation instructions, see the [Installation Guide]({{ site.baseurl }}/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({{ site.baseurl }}/installation/) for setup instructions 2. Review the [Troubleshooting]({{ site.baseurl }}/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.0.4/"
  },
  {
    "title": "",
    "content": "# Release v2.0.5 **Release Date**: July 10, 2025 #### Additions - **Group Analysis Features**: Group analysis system with GUI interface, comparison capabilities, and logging - **Focality Measurement**: New focality analysis tools with histogram generation for cortical analysis - **Normal Component Analysis**: Added normal component matrics and visualization - **Enhanced Workflow**: Multiple subject selection for flex-search, new naming conventions #### Fixes - **GUI Stability**: Multiple bug fixes for group analysis GUI, element resizing, console widget consistency, and special character handling - **Analysis Accuracy**: Improved histogram generation, ROI comparison plots - **Visualization**: Fixed mesh visualization and updated mesh visualizer functionality ## Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.5/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.5/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.0.5/TemporalInterferenceToolbox-Linux-x86_64.AppImage) For installation instructions, see the [Installation Guide]({{ site.baseurl }}/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({{ site.baseurl }}/installation/) for setup instructions 2. Review the [Troubleshooting]({{ site.baseurl }}/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.0.5/"
  },
  {
    "title": "",
    "content": "# Release v2.1.0 **Release Date**: August 25, 2025 #### Additions - **Improved BIDS formatting:** Enhanced Brain Imaging Data Structure (BIDS) compliance and formatting for better data - organization and compatibility - **Debug mode for console output:** Introduced comprehensive debug mode with detailed console logging for troubleshooting and development - **Inter-individual variability assessment:** New bone analyzer tool integrated into pre-processing pipeline for assessing anatomical variations between subjects - **Multi-start approach for flex-search optimization:** Implemented multi-start optimization strategy to counter local maxima issues in electrode placement optimization #### Fixes - **Removed MATLAB runtime dependency:** Eliminated MATLAB runtime requirement, making the toolbox fully independent and easier to deploy - **mTI bug fixes and upstream integration:** Resolved critical bugs in mTI (multi-channel Temporal Interference) functionality and improved integration with upstream SimNIBS components - **Enhanced X11 handling for macOS:** Improved X11 server integration and display management for better GUI - functionality on macOS systems - **Official rebranding:** Complete renaming from TI-CSC to TI-Toolbox across all components, documentation, and user interfaces #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.0/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.0/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.0/TemporalInterferenceToolbox-Linux-x86_64.AppImage) For installation instructions, see the [Installation Guide]({ site.baseurl }/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({ site.baseurl }/installation/) for setup instructions 2. Review the [Troubleshooting]({ site.baseurl }/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.1.0/"
  },
  {
    "title": "",
    "content": "# Release v2.1.1 **Release Date**: August 28, 2025 #### Additions - N/A #### Fixes - **ex-search**: fixed final.csv output - **flex-search**: fixed cleanup of directory if users choose a single start #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.1/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.1/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.1/TemporalInterferenceToolbox-Linux-x86_64.AppImage) For installation instructions, see the [Installation Guide]({ site.baseurl }/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({ site.baseurl }/installation/) for setup instructions 2. Review the [Troubleshooting]({ site.baseurl }/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.1.1/"
  },
  {
    "title": "",
    "content": "# Release v2.1.2 **Release Date**: September 08, 2025 #### Additions - Example Dataset: Toolbox now ships with Ernie & MNI152 MRI scans for quick start & learning purposes. - Tissue Analyzer: Added skin thickness and volume analysis #### Fixes - Various bug fixes: charm, ex-search, flex-search #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.2/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.2/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.2/TemporalInterferenceToolbox-Linux-x86_64.AppImage) For installation instructions, see the [Installation Guide]({ site.baseurl }/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({ site.baseurl }/installation/) for setup instructions 2. Review the [Troubleshooting]({ site.baseurl }/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.1.2/"
  },
  {
    "title": "",
    "content": "# Release v2.1.3 **Release Date**: October 08, 2025 #### Additions - - **Executable Launcher**: pre-flight check for existing containers to avoid start conflicts. - - **Executable Launcher**: validation of path input (for mannual inputs) - - **Flex-search**: dynamic focality thresholding for better output - - **Development**: Added a watchdog for easier GUI development - - **Analyzer**: Added `labeling.nii.gz` as an option for voxel analysis w/o need for recon-all #### Fixes - - **General**: Removed env limits for flex-search, cleaned up GUI tabs, fixed Gmsh GUI lauchner with analysis visuals, fixed example data (ernie, MNI152) mounting in executable mode, clean up of executable console output. - - **Critical**: Batch processing of sub-cortical targets in flex-search mode. Previous, `labeling.nii.gz` was no updating between subjects, causing incorrect optimization targeting. #### Download Links - [Windows Installer](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.3/TI-Toolbox-Windows.exe) - [macOS Universal](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.3/TemporalInterferenceToolbox-macOS-universal.zip) - [Linux AppImage](https://github.com/idossha/TI-Toolbox/releases/download/v2.1.3/TemporalInterferenceToolbox-Linux-x86_64.AppImage) For installation instructions, see the [Installation Guide]({ site.baseurl }/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({ site.baseurl }/installation/) for setup instructions 2. Review the [Troubleshooting]({ site.baseurl }/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.1.3/"
  },
  {
    "title": "",
    "content": "# Release v2.2.0 **Release Date**: November 07, 2025 #### Additions - **Core Infrastructure & Architecture**: The project underwent a complete restructure, removing old launcher directories and consolidating to a unified ti-toolbox structure. A new core module system was introduced in ti-toolbox/core/ with reusable components including paths.py, calc.py, constants.py, errors.py, process.py, utils.py, nifti.py, mesh.py, and viz.py. The project moved away from executable compilation and now focuses exclusively on bash entry point. - **GUI Extensions System**: A new modular extension system was introduced in ti-toolbox/gui/extensions/ providing several powerful tools. The Cluster-Based Permutation Testing (CBP) extension offers statistical analysis for group comparisons. Nilearn Visuals enables brain visualization using nilearn with glass brain views, surface plots, and slices. The NIfTI Group Averaging tool allows averaging multiple NIfTI files across subjects. The Visual Exporter provides export capabilities to Blender-compatible formats (PLY, STL) with a full tutorial. Additional extensions include Quick Notes for in-app note-taking with persistence, Subject Info Viewer for displaying metadata and processing status, and an Electrode Placement Tool for interactive electrode positioning. - **3D Visualization & Export**: A 3D Exporter module was added in ti-toolbox/3d_exporter/ containing four specialized tools. TI_quick_volumetric.py provides fast volumetric field exports, cortical_regions_to_ply.py handles region-specific mesh exports, cortical_regions_to_stl.py outputs STL format for 3D printing, and vector_ply.py enables vector field visualization in Blender. - **MOVEA Optimization**: MOVEA-like integration was implemented for multi-objective optimization of electrode placement. The system now uses a centralized leadfield with unified leadfield target locations across all optimization tools. A complete MOVEA GUI tab provides an interface for optimization workflows. - **Analysis Tool**: Group Analyzer received significant improvements including enhanced multi-subject analysis capabilities with MNI coordinate support. - **Statistics Module**: A statistics package was created in ti-toolbox/stats/. The cluster_permutation.py module implements non-parametric cluster-based permutation testing. - **Simulator Improvements**: The simulator received substantial enhancements including a new free-hand mode that allows direct electrode coordinate input without montage selection. The entire simulator was refactored for a cleaner codebase with better error handling. - **Optimization Tools**: The flex-search tool was restructured and modularized into ti-toolbox/opt/flex/. A multi-start approach was implemented allowing multiple iterations to find the best solution. The ex-search tool received enhancements for better ROI handling and faster analysis. - **GUI Enhancements**: Multiple GUI improvements enhance the user experience. A centralized Path Manager handles path operations across all GUI tabs. Console output was standardized for consistent logging and status updates. Confirmation dialogs now appear before long-running processes. A debug mode provides optional verbose output for troubleshooting. An OpenGL fallback system provides automatic compatibility handling for macOS issues. - **Documentation**: More documentation was added covering new features. New wiki pages document cluster permutation testing, electrode placement, MOVEA optimization, tissue analyzer, visual exporter, nilearn visuals, nifti group averaging, and quick notes. A pipeline flow diagram provides visual representation of the complete workflow. A detailed Blender tutorial offers step-by-step guidance for 3D visualization. Installation documentation was streamlined with updated setup instructions and removal of executable references. The gallery was updated with new screenshots showcasing all GUI features. - **CI/CD & Testing**: A CI/CD pipeline was implemented with automated testing and Codecov integration for code coverage tracking. The test suite was expanded covering most modules, including new test files for calc, constants, core integration, mesh, errors, ex-analyzer, nifti, paths, process, utils, and MOVEA optimizer with integration tests. CircleCI integration now provides automated testing on every commit with proper permissions and workflows. - **Development Tools**: Developer experience was improved with enhanced dev environment setup in dev/bash_dev/ for contributors. Version control management was improved for better consistency across all files. The project standardized on the simnibs_python interpreter for all Python operations. Container communication between FreeSurfer and SimNIBS was enhanced for better data sharing. #### Fixes - **Bug Fixes & Refinements**: Numerous bug fixes and refinements were implemented including BIDS structure compliance improvements, resolution of deadlock issues in GUI tabs, improved overwrite protection across all tools, fixed electrode naming consistency, better handling of network volumes, X11 and OpenGL fixes for cross-platform compatibility, and reduced console bloat with improved logging throughout the application. - **Removals & Cleanup**: Significant cleanup was performed removing all executable launcher code (over 7,000 lines), eliminating old MATLAB dependencies, removing outdated documentation and assets, cleaning up redundant development files. #### Download Links - Docker Image: `docker pull idossha/simnibs:v2.2.0` - **[loader.sh](https://github.com/idossha/TI-toolbox/blob/main/loader.sh)** - Main launch script - **[docker-compose.yml](https://github.com/idossha/TI-toolbox/blob/main/docker-compose.yml)** - Docker configuration For installation instructions, see the [Installation Guide]({{ site.baseurl }}/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({{ site.baseurl }}/installation/) for setup instructions 2. Review the [Troubleshooting]({{ site.baseurl }}/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.2.0/"
  },
  {
    "title": "",
    "content": "# Release v2.2.1 **Release Date**: December 04, 2025 #### Backward compatibility change to be aware: - **Electode Mapping**: We changed the mapping functionality from the **flex-seach** to the **simulator**. This to provide a more flexible and dynamic framework. Now, the flex-search outputs the: `electrode_positions.json` file and the mapping functionality happeneds on the simulator side using the new method `ti-toolbox/tools/map_electrodes.py`. Thus, one can use a single flex-search to conveniently map to multiple nets. #### Additions - **Desktop App**: Recognizing the importance of Desktop delivery, we redesign our executables with Electron. For more info please see `package`. - **Benchmarks**: Added benchmarking tool with sensible defaults that users can run on their systems - **AMV**: Improved automatic montage visualization that now supports all available nets with a higher resolution image. - **Flex-search**: Added more control over electrode geometry now supporting rectengular and width control. - **Flex-search**: Exapnded hyper-parameter control. tolerance and mutation rate. - **Ex-search**: Enhanced the ex-search with current ratio optimization, enabling more robust optimization process. The exhaustive search now evaluates possible electrode montages and current ratios according to the formula: $N_\\text{total} = N_\\text{elec}^4 \\cdot N_\\text{current}$, where $N_\\text{current} = \\{(I_1,I_2) \\mid I_1+I_2=I_\\text{total} \\wedge I_\\text{step} \\leq I_1,I_2 \\leq I_\\text{limit}\\}$. #### Fixes - **Various Bug Fixes**: protection overwrites, documentation, output formatting, UI improvements, parallel processing, electrode management #### Download Links **Desktop App (v2.2.1):** [macOS Intel](https://github.com/idossha/TI-toolbox/releases/download/v2.2.1/TI-Toolbox-x64.dmg) 路 [macOS Apple Silicon](https://github.com/idossha/TI-toolbox/releases/download/v2.2.1/TI-Toolbox-arm64.dmg) 路 [Windows](https://github.com/idossha/TI-toolbox/releases/download/v2.2.1/TI-Toolbox-Setup.exe) 路 [Linux AppImage](https://github.com/idossha/TI-toolbox/releases/download/v2.2.1/TI-Toolbox.AppImage) 路 [Linux deb](https://github.com/idossha/TI-toolbox/releases/download/v2.2.1/ti-toolbox.deb) **Other:** - Docker Image: `docker pull idossha/simnibs:v2.2.1` - Source Code: [GitHub Repository](https://github.com/idossha/TI-Toolbox) For installation instructions, see the [Installation Guide]({{ site.baseurl }}/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({{ site.baseurl }}/installation/) for setup instructions 2. Review the [Troubleshooting]({{ site.baseurl }}/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.2.1/"
  },
  {
    "title": "",
    "content": "# Release v2.2.2 **Release Date**: December 25, 2025 #### Additions - - **Simulator Refactoring**: Complete rewrite from bash to Python with modular architecture including progress callbacks, better error handling, and improved logging. - - **Enhanced Cluster Permutation Testing**: New ACES-like correlation investigation, support for continuous variables, enhanced reporting, and improved GUI integration. - - **Comprehensive Testing Infrastructure**: new test files with code coverage integration, headless operation support, and improved CI/CD pipeline. - - **Improved 3D Visualization**: Enhanced visual exporter with automatic electrode placement, metadata extraction, GLB format export, and Docker-based Blender integration. - - **Pythonic CLI Migration**: New Click-based command-line interfaces for simulator and cluster permutation tools with better argument validation. - - **GUI Enhancements**: Improved threading across all tabs with real-time progress updates, better error handling, and enhanced responsiveness. #### Fixes - - **Various Bug Fixes**: Fixed silent timeout issues in CI, corrected coverage integration, improved error handling in all major modules, better cleanup of temporary files, and enhanced logging. - - **Windows Electron**: A more robust executable delivery on Windows. #### Download Links **Desktop App (v2.2.2):** [macOS Intel](https://github.com/idossha/TI-toolbox/releases/download/v2.2.2/TI-Toolbox-x64.dmg) 路 [macOS Apple Silicon](https://github.com/idossha/TI-toolbox/releases/download/v2.2.2/TI-Toolbox-arm64.dmg) 路 [Windows](https://github.com/idossha/TI-toolbox/releases/download/v2.2.2/TI-Toolbox-Setup.exe) 路 [Linux AppImage](https://github.com/idossha/TI-toolbox/releases/download/v2.2.2/TI-Toolbox.AppImage) 路 [Linux deb](https://github.com/idossha/TI-toolbox/releases/download/v2.2.2/ti-toolbox.deb) **Other:** - Docker Image: `docker pull idossha/simnibs:v2.2.2` - Source Code: [GitHub Repository](https://github.com/idossha/TI-Toolbox) For installation instructions, see the [Installation Guide]({{ site.baseurl }}/installation/). --- ## Getting Help If you encounter issues with this release: 1. Check the [Installation Guide]({{ site.baseurl }}/installation/) for setup instructions 2. Review the [Troubleshooting]({{ site.baseurl }}/installation/#troubleshooting) section 3. Search [existing issues](https://github.com/idossha/TI-Toolbox/issues) 4. Ask in [GitHub Discussions](https://github.com/idossha/TI-Toolbox/discussions)",
    "url": "/releases/v2.2.2/"
  },
  {
    "title": "3D Visual Exporter",
    "content": "The 3D Visual Exporter extension was built to enable better visualization and presentation of simulation results using other 3D modeling software. It bundles the mesh export scripts that ship with TI-Toolbox and provides a single interface for exporting cortical surfaces, field vectors, electrode placements, skin surfaces, and sub-cortical structures in formats compatible with Blender, CAD software, and other 3D visualization tools. Use it when you want a guided workflow from the GUI, or call the underlying Python scripts directly for batch jobs and automation. ## Overview - **Location**: `ti-toolbox/gui/extensions/visual_exporter.py` - **Purpose**: Export 3D assets in formats compatible with Blender, CAD software, and other 3D modeling tools to enable better visualization and presentation of simulation results. - **Back-end scripts**: - `3d_exporter/cortical_regions_to_ply.py` - `3d_exporter/cortical_regions_to_stl.py` - `3d_exporter/vector_ply.py` - `3d_exporter/electrode_placement.py` - `tools/extract_labels.py` - `tools/nifti_to_mesh.py` - **Outputs**: PLY surface meshes, STL geometry, PLY vector clouds, electrode placements (.blend/.glb), skin surfaces, and sub-cortical structures stored under the TI-Toolbox derivatives tree. ## Supported Modes ### Cortical Regions This mode exports cortical surface regions defined by anatomical atlases as 3D mesh files. The exporter uses the central cortical surface mesh generated from your simulation and segments it according to the selected atlas labels. STL format export showing cortical surface geometry PLY format export with color-mapped field data PLY format export showing detailed cortical regions &#10094; &#10095; **What is produced:** - **STL files**: Binary STL format containing only geometry (no color information). These are lightweight files suitable for CAD software, 3D printing, or any workflow that doesn't require color mapping. - **PLY files**: PLY format with embedded color information. Each region is color-mapped according to the field values (e.g., `TI_max`) from the simulation mesh. These files preserve both geometry and field data for visualization in Blender or other 3D tools. **Atlas options:** - Choose from available atlases (DK40, DKTatlas40, HCP_MMP1, aparc.a2009s) based on your analysis needs. - Select individual cortical regions to export, or export the entire atlas. - Optionally include the whole gray matter (GM) surface as a single mesh file. **Output structure:** - Individual region meshes are stored in `regions/` subdirectories. - Whole GM surface is exported as a separate file when enabled. - Optionally keep intermediate `.msh` files for audit trails and debugging. ### Field Vectors This mode exports electric field vectors from TDCS simulations as arrow clouds in PLY format. The vectors represent the electric field direction and magnitude at sampled points in the brain. TI vector field visualization showing electric field directions and magnitudes Close-up view of the vector field, highlighting individual arrow placement and detail RGB color-coded vectors showing CH1 (red), CH2 (blue), TI (green), TI_sum (yellow), and TI_normal (cyan) fields &#10094; &#10095; **What is produced:** - **CH1 (Channel 1)**: Vector field from the first TDCS electrode configuration. Represents the electric field distribution (E1) when current flows through channel 1. **Color**: Red (RGB: 255, 0, 0) in RGB mode. - **CH2 (Channel 2)**: Vector field from the second TDCS electrode configuration. Represents the electric field distribution (E2) when current flows through channel 2. **Color**: Blue (RGB: 0, 0, 255) in RGB mode. - **TI (Temporal Interference)**: Modulation amplitude vectors representing the temporal interference pattern when two electric fields with slightly different frequencies interfere. The TI vector indicates both the spatial direction of maximum envelope modulation and the magnitude of maximum envelope amplitude (2  effective amplitude). Calculated using the Grossman et al. 2017 algorithm, which computes the modulation amplitude when two sinusoidal fields E1(t) and E2(t) create a beating pattern. **Color**: Green (RGB: 0, 255, 0) in RGB mode. - **TI_sum**: Optional output representing the vector addition of CH1 and CH2 (E1 + E2). This is the direct vector sum of the two electric field vectors, useful for visualizing the combined field distribution. **Color**: Yellow (RGB: 255, 255, 0) in RGB mode. - **TI_normal**: Optional output representing the component of the TI vector normal to the cortical surface. This is particularly useful for understanding stimulation perpendicular to the cortex, as it isolates the component of the modulation amplitude that is orthogonal to the gray matter surface. **Color**: Cyan (RGB: 0, 255, 255) in RGB mode. **Vector properties:** - Each arrow's direction represents the electric field direction at that point. - Arrow length is scaled by the field magnitude (configurable via length scale parameter). - Colors can be mapped using RGB mode (fixed colors per vector type: CH1=red, CH2=blue, TI=green, TI_sum=yellow, TI_normal=cyan) or magnitude-based scaling (magscale) to visualize field intensity across a blue-green-red gradient. - Vector width and anchor point (tail or head) are customizable for visualization clarity. **TI vs mTI modes:** - **TI mode**: Uses 2 TDCS meshes (CH1 and CH2) to compute standard TI vectors. - **mTI mode**: Uses 4 TDCS meshes (CH1, CH2, CH3, CH4) to compute multi-channel TI vectors, enabling more complex stimulation patterns. **Sampling options:** - Configure the number of vectors to sample (default: 100,000) or use all nodes for maximum detail. - When using the maximum sample count, the script will produce a vector on every node of the given surface mesh. This is an expensive process that requires a large amount of memory and can take multiple hours for all vectors to be produced. - Random seed controls reproducibility of sampling patterns. - Vectors can be filtered to show only top percentile regions by magnitude. ### Electrode Placement This mode creates 3D electrode placements on the scalp surface using Blender for visualization. It automatically extracts the scalp surface from the subject's mesh file and places electrode objects according to EEG montage coordinates, with optional text labels. Electrode placement on scalp surface with sub-cortical thalamus ROI visualization Interactive 3D Electrode Model Interactive 3D view of GSN-HydroCel-185 electrode placement on scalp surface (GLB format) **What is produced:** - **.blend file**: Blender scene file containing scalp surface, electrode objects, and text labels - **.glb file**: GLTF binary format for web-based 3D viewers or other applications (e.g., `electrodes_GSN-HydroCel-185.glb`) - **scalp.stl**: Extracted scalp surface mesh for reference **Electrode configuration:** - Choose from available EEG montages (automatically detected from the subject's eeg_positions directory) - Adjust electrode size, offset distance from scalp surface, and text label positioning - Scale factor for coordinate system adjustments **Blender integration:** - Uses headless Blender (simnibs_blender) for automated electrode placement - Requires Blender to be installed on the system - Electrode template objects are defined in `3d_exporter/Electrode.blend` ### Sub-cortical Extraction This mode extracts sub-cortical structures from NIfTI segmentation files and converts them to 3D mesh formats. It can extract specific anatomical regions by label or export the entire segmentation volume. **What is produced:** - **STL files**: Binary STL format geometry files suitable for CAD software and 3D printing - **MSH files**: SimNIBS mesh format for compatibility with simulation workflows - **NIfTI files**: Copied segmentation files for reference **Segmentation options:** - Extract specific anatomical labels (e.g., thalamus: 10,49) or export the entire volume - Optional cleaning of small disconnected components to reduce mesh complexity - Automatic label extraction from FreeSurfer or other segmentation atlases **Input sources:** - Default: `m2m_/segmentation/labeling.nii.gz` (FreeSurfer segmentation) - Custom: Any NIfTI file containing labeled anatomical regions ## Running from the GUI 1. Launch TI-Toolbox and click the **Extensions** button in the top-right corner of the window. 2. Select **3D Visual Exporter** and click **Launch**. 3. Pick a subject and simulation from the dropdowns. The extension queries the Path Manager for available outputs. 4. Choose **Cortical Regions**, **Field Vectors**, **Electrode Placement**, or **Sub-cortical** mode. 5. Configure atlas, region filters, formats, and output directory options (for regions), sampling and styling parameters (for vectors), EEG montage and electrode settings (for electrode placement), or NIfTI file and label extraction settings (for sub-cortical structures). 6. Click **Run Export**. The console panel shows the exact commands executed and live progress. 7. Review artifacts in `derivatives/ti-toolbox/visual_exports/sub-//` once the export completes. The **Stop** button terminates the active subprocess if you need to cancel a long export. ## Running the scripts individually You can call the Python scripts directly whenever you need command-line automation or custom batching. From within the TI-Toolbox environment, run: ```bash # Export atlas-aligned cortical regions to PLY simnibs_python 3d_exporter/cortical_regions_to_ply.py \\ --mesh \\ --m2m \\ --output-dir # Export region geometry to STL simnibs_python 3d_exporter/cortical_regions_to_stl.py \\ --mesh \\ --m2m \\ --output-dir # Export TI or mTI vector arrows simnibs_python 3d_exporter/vector_ply.py \\ tdcs1.msh tdcs2.msh --sum --ti-normal # Place electrodes on scalp surface simnibs_python 3d_exporter/electrode_placement.py \\ --subject-id \\ --electrode-csv \\ --subject-msh \\ --output-dir # Extract sub-cortical structures from NIfTI simnibs_python tools/extract_labels.py \\ \\ --labels 10 49 \\ --output simnibs_python tools/nifti_to_mesh.py \\ \\ \\ --clean-components ``` Refer to the README files in `ti-toolbox/3d_exporter/` and `tools/` directories for full command-line options, including electrode placement parameters, sub-cortical label extraction, and mesh cleaning options. ## Output structure Exports triggered from the extension (or using the same base output directory) follow this structure: ``` derivatives/ ti-toolbox/ visual_exports/ sub-/ / stl/ # Cortical STL exports ply/ # Cortical PLY exports vectors/ # Vector PLY exports electrodes/ # Electrode placement exports (.blend, .glb, scalp.stl) subcortical/ # Sub-cortical structure exports (.stl, .msh, .nii.gz) ``` Vector exports append suffixes such as `_CH1`, `_CH2`, `_TI`, `_TI_sum`, and `_TI_normal`. Cortical exports include `cortical_stls/` and `cortical_plys/` subfolders with `regions/` and `whole_gm` outputs. Electrode exports include Blender scene files and GLTF models. Sub-cortical exports include mesh files with descriptive suffixes indicating the extracted labels and processing options. ## Tips and troubleshooting - **Environment**: Run the commands from within the TI-Toolbox environment. The scripts handle SimNIBS dependencies automatically. - **Missing fields**: The cortical exporters expect the requested `--field` (default `TI_max`) to exist on the mesh. Inspect field names with `simnibs_python -c \"import simnibs; print(simnibs.read_msh('mesh.msh').field.keys())\"`. - **Large vector clouds**: Start with smaller `--count` values or enable `--top-percent` to reduce file sizes before ramping up density. - **Atlas updates**: If you add a new atlas, ensure the `m2m_*` directory contains the matching label files before launching the GUI. - **Blender requirement**: Electrode placement mode requires Blender to be installed (`apt-get install -y blender` on Ubuntu/Debian). The system will automatically detect and use `simnibs_blender` if available. - **EEG montages**: Ensure EEG position files are present in the subject's `eeg_positions/` directory. The extension automatically detects available montages. - **Sub-cortical segmentation**: For sub-cortical extraction, verify your NIfTI file contains labeled anatomical regions. FreeSurfer's `labeling.nii.gz` uses standard FreeSurfer label numbers. - **Label extraction**: When extracting specific labels, use comma-separated values (e.g., \"10,49\" for left/right thalamus). Check FreeSurfer's label lookup table for anatomical region codes. - **Error logs**: The extension console mirrors stdout/stderr from the scripts. Copy the failing command and re-run in a terminal to investigate with additional flags (for example `--verbose`). ## Blender Tutorial: Visualizing PLY Files This tutorial walks you through importing and visualizing PLY files exported from TI-Toolbox in Blender, including how to display the embedded color attributes. ### Step 1: Importing PLY Files 1. Open Blender and start with the default scene (or create a new project). 2. Go to **File**  **Import**  **Stanford (.ply)**. 3. Navigate to your exported PLY file location (typically in `derivatives/ti-toolbox/visual_exports/sub-//ply/`). 4. Select your PLY file and click **Import Stanford (.ply)**. The mesh will appear in your viewport. If the mesh appears very small or very large, you may need to adjust the view or scale the object. ![Import PLY file]({{ site.baseurl }}/assets/imgs/wiki/visual-exporter/visual_exporter_blender_1.png) ### Step 2: Switching to Material Preview To see materials and colors properly, switch the viewport shading mode: 1. In the 3D viewport, locate the viewport shading buttons in the top-right corner (or press `Z` to open the viewport shading menu). 2. Select **Material Preview** mode (or press `Z` then `2`). Material Preview mode provides a quick preview of how materials will look with basic lighting, making it ideal for checking color attributes. ![Material Preview mode]({{ site.baseurl }}/assets/imgs/wiki/visual-exporter/visual_exporter_blender_2.png) ### Step 3: Adding a Material To display the color attributes from your PLY file, you need to create and assign a material: 1. Select your imported PLY mesh object in the viewport. 2. In the **Material Properties** panel (right sidebar, indicated by a sphere icon), click **New** to create a new material. 3. The material will be automatically assigned to your selected object. ![Adding a material]({{ site.baseurl }}/assets/imgs/wiki/visual-exporter/visual_exporter_blender_3.png) ### Step 4: Setting Color to 'col' Attribute To use the color data embedded in your PLY file (stored in the `col` attribute), set it as the material's base color: 1. With your object still selected, in the **Material Properties** panel, locate the **Base Color** field (under the **Surface** section). 2. Click on the **Base Color** field. 3. Select **Color Attribute** from the dropdown menu. 4. In the attribute name field that appears, enter `col` (this matches the color attribute name in your PLY file). Your mesh should now display the color-mapped field data from your simulation. The colors represent the field values (e.g., `TI_max`) that were exported with the mesh. Adding the Attribute node and setting it to 'col' Final result with color attribute connected to the material &#10094; &#10095; **Note**: If your PLY file uses a different attribute name for colors, replace `col` in step 4 with the appropriate attribute name. You can check available attributes by selecting the mesh and viewing the **Geometry Nodes** or **Mesh Data** properties.",
    "url": "/wiki/visual-exporter/"
  },
  {
    "title": "Wiki",
    "content": "Welcome to the Temporal Interference Toolbox Wiki. Here you'll find detailed guides and documentation for all aspects of the toolbox. ### Core Functionality - **[Pre-Processing](pre-processing)** - Data preparation and mesh generation workflows - **[Flex Search](flex-search)** - TI optimization pipeline based on differntial evolutionary algorithm - **[Ex Search](ex-search)** - TI optimization pipeline based on leadfield matrices - **[Simulator](simulator)** - Simualtor with flexible parameter input - **[Analyzer](analyzer)** - Comprehensive field analysis for both mesh and voxel data ### Embedded Tools - **[Reports](reports)** - Understanding HTML simulation reports and results - **[Logging](logging)** - Comprehensive logging system documentation - **[Atlas Resampling](atlas-resampling)** - Working with brain atlases and resampling - **[Montage Visualizer](montage_visualizer)** - Electrode montage visualization on head - **[Electrode Mapping](electrode-mapping)** - Optimal electrode position mapping to EEG nets ### Extensions - **[Extension System](extension)** - Modular plugin architecture and development guide - **[Electrode Placement](electrode-placement)** - Interactive 3D electrode positioning on head surfaces - **[Nilearn Visuals](nilearn-visuals)** - Publication-ready brain visualizations - **[Cluster-Based Permutation Testing](cluster-permutation-testing)** - Non-parametric statistical analysis - **[Quick Notes](quick-notes)** - Timestamped note-taking during analysis sessions - **[NIfTI Group Averaging](nifti-group-averaging)** - Group analysis and comparison tools - **[Tissue Analyzer](tissue-analyzer)** - Volume and thickness assessment for CSF, bone, and skin ### Development & Testing - **[Testing Pipeline](testing-pipeline)** - Comprehensive CI/CD testing pipeline with CircleCI integration - **[Python Environment](python_env)** - Managing the SimNIBS Python environment and dependencies - **[Desktop App](desktop-app)** - Electron-based launcher architecture and workflow ## Support For additional help, installation instructions, and development resources, check the links in the sidebar or visit our [GitHub repository](https://github.com/idossha/TI-Toolbox).",
    "url": "/wiki/"
  },
  {
    "title": "Windows Installation",
    "content": "## Prerequisites ### Ubuntu from Microsoft Store 1. **Install Ubuntu from Microsoft Store**: - Search for \"Ubuntu\" in the Microsoft Store - Install the latest Ubuntu version (this automatically sets up WSL2) 2. **Launch Ubuntu** from Start Menu and complete initial setup 3. **Update Ubuntu** (first time setup): ```bash sudo apt update && sudo apt upgrade -y ``` ### Docker Desktop Integration 1. **Install Docker Desktop** for Windows 2. **Enable Ubuntu integration**: - Open Docker Desktop settings - Go to \"Resources\" > \"WSL Integration\" - Enable integration with your Ubuntu distribution ![Docker Settings on Windows]({{ site.baseurl }}/assets/imgs/installation/docker_windows.png){:style=\"max-width: 800px;\"} 3. **Restart Docker Desktop** after enabling integration ### X Server for GUI Install [VcXsrv](https://sourceforge.net/projects/vcxsrv/) for GUI display: - Download and install VcXsrv ## Option 1: Desktop App Download the pre-built desktop application for Windows from the **[Latest Release](https://github.com/idossha/TI-toolbox/releases/latest)**: | Platform | Download | |----------|----------| | **Windows** | `TI-Toolbox-Setup-{version}.exe` | Simply download and run the installer  the app handles Docker management and WSL2 setup for you. ## Option 2: Command Line --- ## Setup Steps ### Step 1: Download Required Files Download these files to your **Windows filesystem**: - **[loader.sh](https://github.com/idossha/TI-toolbox/blob/main/loader.sh)** - **[docker-compose.yml](https://github.com/idossha/TI-toolbox/blob/main/docker-compose.yml)** **Recommended**: Create a dedicated folder like `C:\\TI-Toolbox\\` for these files. ### Step 2: Launch from Ubuntu 1. **Open Ubuntu** (search for \"Ubuntu\" in Windows Start menu) 2. **Navigate to your files** using WSL path format: ```bash cd /mnt/c/TI-Toolbox/ ``` *(Note: Windows `C:\\TI-Toolbox\\` becomes `/mnt/c/TI-Toolbox/` in WSL)* 3. **Make loader.sh executable**: ```bash chmod +x loader.sh ``` 4. **Ensure Docker Desktop is running** on Windows 5. **Launch TI-Toolbox**: ```bash ./loader.sh ``` 6. **First run will download Docker images (~30GB)** - this may take 30+ minutes ## File Mounting Considerations ### Accessing Windows Files from Ubuntu - Windows drives are mounted under `/mnt/` in Ubuntu - `C:\\Users\\YourName\\Desktop\\`  `/mnt/c/Users/YourName/Desktop/` - Use Ubuntu paths when running commands in the terminal ### Project Data Location - Store your TI-Toolbox project data in your Windows filesystem - Access via Ubuntu paths (e.g., `/mnt/c/{project-name}`) - Docker containers will inherit Ubuntu's access to Windows files ## Troubleshooting ### Docker Integration Issues - **WSL integration not enabled**: Check Docker Desktop settings under \"Resources\" > \"WSL Integration\" - **Docker daemon not accessible**: Restart Docker Desktop and ensure WSL integration is active ### X Server (VcXsrv) Issues - **GUI not appearing**: Ensure VcXsrv is running and \"Disable access control\" is checked - **Connection refused**: Configure VcXsrv to allow connections from WSL2 (default settings usually work) --- **Next Steps**: - [Dependencies](../dependencies/) - If you need to revisit dependency setup - [Troubleshooting](../troubleshooting/) - For common issues and solutions - [Quick Start](../) - Return to main installation guide",
    "url": "/installation/windows/"
  }
]
