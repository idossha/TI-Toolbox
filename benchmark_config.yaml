# ======================================================================
# TI-Toolbox Benchmark Configuration - Pipeline Setup
# ======================================================================
# Global benchmark settings
output_dir: /mnt/TIT_benchmarking/benchmark_results  # Main directory for benchmark results and logs
keep_project: true                                   # Keep temporary project directories after completion
debug_mode: true                                     # Enable verbose debug logging

# ======================================================================
# Pipeline Flow:
# 1. DICOM → Converts to NIfTI in /mnt/TIT_benchmarking/sub-101/
# 2. CHARM → Uses NIfTI to create meshes in /mnt/TIT_benchmarking/sub-101/m2m_101/
# 3. RECON → Uses NIfTI for FreeSurfer in /mnt/TIT_benchmarking/sub-101/
# 4. LEADFIELD → Uses CHARM meshes to create leadfield matrices
# 5. FLEX → Uses CHARM meshes for optimization
# 6. EX_SEARCH → Uses LEADFIELD output for exhaustive search
# ======================================================================

# ======================================================================
# STEP 1: DICOM Benchmark - DICOM to NIfTI conversion
# ======================================================================
dicom:
  # Project setup - Output goes to shared pipeline directory
  project_dir: /mnt/TIT_benchmarking
  
  # Input data - Raw DICOM files
  subject_source: /mnt/TIT_benchmarking/sourcedata/sub-101/
  subject_id: 101
  
  # Script path
  dicom_script: /development/ti-toolbox/pre/dicom2nifti.sh
  
  # Output: /mnt/TIT_benchmarking/sub-101/anat/*.nii.gz

# ======================================================================
# STEP 2: CHARM Benchmark - Head mesh (m2m) creation
# ======================================================================
charm:
  # Project setup - Use DICOM output directory
  project_dir: /mnt/TIT_benchmarking
  
  # Input data - From DICOM step output
  t1_image: /mnt/TIT_benchmarking/sub-101/anat/sub-101_T1w.nii.gz
  t2_image: /mnt/TIT_benchmarking/sub-101/anat/sub-101_T2w.nii.gz
  subject_id: 101
  
  # Script path
  charm_script: /development/ti-toolbox/pre/charm.sh
  
  # Options
  clean: false                                       # Clean existing m2m directory before running
  
  # Output: /mnt/TIT_benchmarking/sub-101/m2m_101/

# ======================================================================
# STEP 3: RECON-ALL Benchmark - FreeSurfer reconstruction
# ======================================================================
recon:
  # Project setup - Use DICOM output directory
  project_dir: /mnt/TIT_benchmarking
  
  # Input data - From DICOM step output
  t1_image: /mnt/TIT_benchmarking/sub-101/anat/sub-101_T1w.nii.gz
  t2_image: /mnt/TIT_benchmarking/sub-101/anat/sub-101_T2w.nii.gz
  subject_id: 101
  
  # Script path
  recon_script: /development/ti-toolbox/pre/recon-all.sh
  
  # Options
  parallel: false                                    # Enable parallel processing
  clean: false                                       # Clean existing FreeSurfer directory before running
  
  # Output: /mnt/TIT_benchmarking/derivatives/freesurfer/sub-101/

# ======================================================================
# STEP 4: LEADFIELD Benchmark - Leadfield matrix generation
# ======================================================================
leadfield:
  # Project setup - Use shared pipeline directory
  project_dir: /mnt/TIT_benchmarking
  
  # Input - From CHARM step output
  m2m_dir: /mnt/TIT_benchmarking/derivatives/SimNIBS/sub-101/m2m_101
  
  # Leadfield generation parameters
  electrode_csv: EEG10-10_UI_Jurak_2007.csv
  tissues: [1, 2]                                    # Tissue types to include (1=GM, 2=WM)
  
  Output: /mnt/TIT_benchmarking/sub-101/leadfields/101_leadfield_EEG10-10_UI_Jurak_2007.hdf5

# ======================================================================
# STEP 5: FLEX-SEARCH Benchmark - TI optimization with differential evolution
# ======================================================================
flex:
  # Project setup - Use shared pipeline directory
  project_dir: /mnt/TIT_benchmarking
  
  # Input - From CHARM step output
  m2m_dir: /mnt/TIT_benchmarking/derivatives/SimNIBS/sub-101/m2m_101
  
  # Core optimization parameters
  opt_goal: mean                                     # Options: mean, max, focality
  postproc: max_TI                                   # Options: max_TI, dir_TI_normal, dir_TI_tangential
  
  # ROI configuration (for spherical ROI method)
  roi_method: spherical                              # Options: spherical, atlas, subcortical
  roi_center: [0, 0, 0]                             # ROI center coordinates (x, y, z) in mm
  roi_radius: 10.0                                   # ROI radius in mm
  
  # Electrode parameters
  eeg_net: 10-10                                     # EEG cap configuration (CSV filename without .csv)
  electrode_radius: 4.0                              # Electrode radius in mm
  electrode_current: 1.0                             # Electrode current in mA
  
  # Optimizer settings
  multistart: [1, 3, 5]                                 # Multi-start values to test
  iterations: 500                                    # Max iterations for differential_evolution
  popsize: 13                                        # Population size for differential_evolution
  cpus: 12                                            # Number of CPU cores to use
  
  # Optional: Focality-specific parameters (only used if opt_goal: focality)
  # thresholds: 0.5                                  # Single value or comma-separated values
  # non_roi_method: everything_else                  # Options: everything_else, specific
  
  # Optional: Mapping settings (disabled by default)
  # enable_mapping: false                            # Map optimal electrodes to nearest EEG-net nodes
  # disable_mapping_simulation: false                # Skip simulation with mapped electrodes
  
  # Optional: Output control
  run_final_simulation: false                        # Run final simulation with optimal electrodes (default: false)
  
  # Output: /mnt/TIT_benchmarking/sub-101/flex_results/

# ======================================================================
# STEP 6: EX-SEARCH Benchmark - Exhaustive TI electrode search
# ======================================================================
ex_search:
  # Project setup - Use shared pipeline directory
  project_dir: /mnt/TIT_benchmarking
  
  # Input - From CHARM and LEADFIELD step outputs
  m2m_dir: /mnt/TIT_benchmarking/derivatives/SimNIBS/sub-101/m2m_101
  leadfield: /mnt/TIT_benchmarking/sub-101/leadfields/101_leadfield_EEG10-10_UI_Jurak_2007.hdf5
  
  # Optimization parameters
  n_electrodes: [2, 4, 6]                            # Number of electrodes per channel (E1+, E1-, E2+, E2-) - can be single value or list
  total_current: 2.0                                 # Total current in mA
  step_size: 0.2                                     # Current step size in mA
  channel_limit: 1.6                                 # Channel current limit in mA (null = total_current/2)

  # ROI configuration
  roi_center: [0, 0, 0]                             # ROI center coordinates (x, y, z) in mm
  roi_radius: 10.0                                   # ROI radius in mm
  
  # Output: /mnt/TIT_benchmarking/sub-101/ex_search_results/

# ======================================================================
# STEP 7: SIMULATOR Benchmark - TI/mTI simulation execution
# ======================================================================
simulator:
  # Project setup - Use shared pipeline directory
  project_dir: /mnt/TIT_benchmarking
  
  # Input - From CHARM step output
  m2m_dir: /mnt/TIT_benchmarking/derivatives/SimNIBS/sub-101/m2m_101
  subject_id: 101
  
  # Script path
  simulator_script: /development/ti-toolbox/cli/simulator.sh
  
  # Simulation parameters
  montage: test_montage                          # Name of montage to simulate
  sim_mode: U                                    # U=Unipolar, M=Multipolar
  conductivity: scalar                           # scalar, vn, dir, or mc
  current: 0.001,0.001                          # Current per channel in Amperes
  eeg_net: GSN-HydroCel-185.csv                     # EEG cap file
  electrode_shape: ellipse                          # rect or ellipse
  dimensions: 8,8                              # Electrode dimensions in mm
  thickness: 4                                   # Electrode thickness in mm
  
  # Output: /mnt/TIT_benchmarking/sub-101/Simulations/

# ======================================================================
# Pipeline Summary:
# ======================================================================
# All benchmarks share the base directory: /mnt/TIT_benchmarking/
# 
# Data flow:
# sourcedata/sub-101/          → [DICOM]     → sub-101/anat/*.nii.gz
# sub-101/anat/*.nii.gz        → [CHARM]     → derivatives/SimNIBS/sub-101/m2m_101/
# sub-101/anat/*.nii.gz        → [RECON]     → derivatives/freesurfer/sub-101/
# derivatives/.../m2m_101/     → [LEADFIELD] → sub-101/leadfields/*.hdf5
# derivatives/.../m2m_101/     → [FLEX]      → sub-101/flex_results/
# sub-101/leadfields/*.hdf5    → [EX_SEARCH] → sub-101/ex_search_results/
# derivatives/.../m2m_101/     → [SIMULATOR] → derivatives/SimNIBS/sub-101/Simulations/

# ======================================================================
